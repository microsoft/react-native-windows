{"version":3,"file":"ComponentPerfTestBase.js","sourceRoot":"","sources":["../../src/base/ComponentPerfTestBase.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Copyright (c) Microsoft Corporation.\r\n * Licensed under the MIT License.\r\n *\r\n * @format\r\n */\r\n\r\nimport * as React from 'react';\r\nimport {measurePerf} from '../core/measurePerf';\r\nimport type {\r\n  IComponentPerfTest,\r\n  IScenario,\r\n  PerfTestCategory,\r\n} from '../interfaces/IComponentPerfTest';\r\nimport type {PerfMetrics} from '../interfaces/PerfMetrics';\r\nimport type {PerfThreshold} from '../interfaces/PerfThreshold';\r\nimport {DEFAULT_THRESHOLD} from '../interfaces/PerfThreshold';\r\n\r\n/**\r\n * Abstract base class for all component performance tests.\r\n *\r\n * Extend this class to create perf tests for any React Native component —\r\n * whether it's a core RNW component, an extended component like RefreshControl,\r\n * or a community-provided custom native component.\r\n *\r\n * The base class provides:\r\n * - Standard mount/unmount/rerender scenarios out of the box\r\n * - A `getCustomScenarios()` hook for component-specific measurements\r\n * - A `generateTestSuite()` helper that creates a full Jest describe/test block\r\n * - Default thresholds that can be overridden per-component\r\n *\r\n * @example\r\n * ```typescript\r\n * // Community usage for a custom native component:\r\n * class MySliderPerfTest extends ComponentPerfTestBase {\r\n *   readonly componentName = 'MySlider';\r\n *   readonly category = 'custom';\r\n *   readonly testId = 'perf-test-my-slider';\r\n *\r\n *   createComponent(props?: Record<string, unknown>) {\r\n *     return <MySlider testID={this.testId} {...props} />;\r\n *   }\r\n * }\r\n * ```\r\n *\r\n * @example\r\n * ```typescript\r\n * // RNW internal usage for a new component:\r\n * class RefreshControlPerfTest extends ComponentPerfTestBase {\r\n *   readonly componentName = 'RefreshControl';\r\n *   readonly category = 'extended';\r\n *   readonly testId = 'perf-test-refreshcontrol';\r\n *\r\n *   createComponent(props?: Record<string, unknown>) {\r\n *     return (\r\n *       <ScrollView\r\n *         refreshControl={\r\n *           <RefreshControl testID={this.testId} refreshing={false} {...props} />\r\n *         }\r\n *       />\r\n *     );\r\n *   }\r\n *\r\n *   getCustomScenarios(): IScenario[] {\r\n *     return [{\r\n *       name: 'refresh-animation',\r\n *       description: 'Measure refresh animation cycle',\r\n *       run: () => this.measureRefreshAnimation(),\r\n *     }];\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class ComponentPerfTestBase implements IComponentPerfTest {\r\n  abstract readonly componentName: string;\r\n  abstract readonly category: PerfTestCategory;\r\n  abstract readonly testId: string;\r\n\r\n  /**\r\n   * Override to customize thresholds for this component.\r\n   * Defaults to the global DEFAULT_THRESHOLD.\r\n   */\r\n  get defaultThreshold(): PerfThreshold {\r\n    return DEFAULT_THRESHOLD;\r\n  }\r\n\r\n  /**\r\n   * Create the React element to be measured.\r\n   * Override this in every subclass.\r\n   *\r\n   * @param props - Optional additional props to pass to the component.\r\n   */\r\n  abstract createComponent(\r\n    props?: Record<string, unknown>,\r\n  ): React.ReactElement;\r\n\r\n  // ─── Standard Scenarios ───\r\n\r\n  async measureMount(): Promise<PerfMetrics> {\r\n    return measurePerf(this.createComponent(), {\r\n      name: `${this.componentName} mount`,\r\n      runs: this.defaultThreshold.minRuns ?? 10,\r\n      warmupRuns: 1,\r\n    });\r\n  }\r\n\r\n  async measureUnmount(): Promise<PerfMetrics> {\r\n    return measurePerf(this.createComponent(), {\r\n      name: `${this.componentName} unmount`,\r\n      runs: this.defaultThreshold.minRuns ?? 10,\r\n      warmupRuns: 1,\r\n      measureUnmount: true,\r\n    });\r\n  }\r\n\r\n  async measureRerender(): Promise<PerfMetrics> {\r\n    const component = this.createComponent();\r\n    return measurePerf(component, {\r\n      name: `${this.componentName} rerender`,\r\n      runs: this.defaultThreshold.minRuns ?? 10,\r\n      warmupRuns: 1,\r\n      scenario: async helpers => {\r\n        // Default re-render: update with same element (forces reconciliation)\r\n        helpers.rerender(this.createComponent({key: Date.now()}));\r\n      },\r\n    });\r\n  }\r\n\r\n  // ─── Extension Point ───\r\n\r\n  /**\r\n   * Override to add component-specific scenarios.\r\n   * Return an empty array if there are no custom scenarios.\r\n   */\r\n  getCustomScenarios(): IScenario[] {\r\n    return [];\r\n  }\r\n\r\n  // ─── Test Suite Generator ───\r\n\r\n  /**\r\n   * Generates a complete Jest test suite for this component.\r\n   *\r\n   * Call this from your `.perf-test.tsx` file to automatically create\r\n   * describe/test blocks for all standard and custom scenarios.\r\n   *\r\n   * @param customThreshold - Optional threshold override for snapshot matching.\r\n   */\r\n  generateTestSuite(customThreshold?: Partial<PerfThreshold>): void {\r\n    const self = this;\r\n\r\n    describe(`${this.componentName} Performance`, () => {\r\n      test('mount time', async () => {\r\n        const perf = await self.measureMount();\r\n        expect(perf).toMatchPerfSnapshot(customThreshold);\r\n      });\r\n\r\n      test('unmount time', async () => {\r\n        const perf = await self.measureUnmount();\r\n        expect(perf).toMatchPerfSnapshot(customThreshold);\r\n      });\r\n\r\n      test('rerender time', async () => {\r\n        const perf = await self.measureRerender();\r\n        expect(perf).toMatchPerfSnapshot(customThreshold);\r\n      });\r\n\r\n      // Custom scenarios\r\n      const customScenarios = self.getCustomScenarios();\r\n      if (customScenarios.length > 0) {\r\n        describe(`${self.componentName}-Specific Scenarios`, () => {\r\n          for (const scenario of customScenarios) {\r\n            test(scenario.name, async () => {\r\n              const perf = await scenario.run();\r\n              expect(perf).toMatchPerfSnapshot(customThreshold);\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n"]}