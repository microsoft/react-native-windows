{"version":3,"file":"git.js","sourceRoot":"","sources":["../src/git.ts"],"names":[],"mappings":";AAAA;;;;;;;;GAQG;;;AAEH,iCAA6B;AAE7B;;;GAGG;AACH,MAAa,OAAO;IAGlB,YAAY,GAAW;QACrB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IACjB,CAAC;IAED,2BAA2B;IAC3B,KAAK,CAAC,KAAK,CAAC,MAAc;QACxB,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAClC,CAAC;IAED,yDAAyD;IACzD,KAAK,CAAC,QAAQ,CAAC,GAAW;QACxB,MAAM,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,iBAAiB,CAAC,IAAY,EAAE,UAAmB;QACvD,MAAM,IAAI,GAAG,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACtC,IAAI,UAAU,EAAE;YACd,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACvB;QACD,MAAM,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;IAC1B,CAAC;IAED,yCAAyC;IACzC,KAAK,CAAC,QAAQ;QACZ,MAAM,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;IACjC,CAAC;IAED,8CAA8C;IAC9C,KAAK,CAAC,MAAM,CAAC,OAAe;QAC1B,MAAM,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;IAC1C,CAAC;IAED,0DAA0D;IAC1D,KAAK,CAAC,IAAI,CACR,MAAc,EACd,MAAc,EACd,IAAwB;QAExB,MAAM,IAAI,GAAG,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QACtC,IAAI,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,EAAE;YACf,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SACtB;QACD,MAAM,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;IAC1B,CAAC;IAED,gDAAgD;IAChD,KAAK,CAAC,QAAQ,CAAC,GAAW;QACxB,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;IACpC,CAAC;IAED,mEAAmE;IACnE,KAAK,CAAC,aAAa;QACjB,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,cAAc,EAAE,MAAM,CAAC,CAAC;IACvD,CAAC;IAED,8DAA8D;IAC9D,KAAK,CAAC,eAAe,CAAC,QAAiB;QACrC,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAC;QACvC,IAAI,QAAQ,EAAE;YACZ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;SAC3B;QACD,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED,wDAAwD;IACxD,KAAK,CAAC,UAAU;QACd,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IAClC,CAAC;IAED,8CAA8C;IAC9C,KAAK,CAAC,GAAG,CAAC,IAAsC;QAC9C,MAAM,IAAI,GAAG,CAAC,KAAK,EAAE,YAAY,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;QAChD,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACvB;QACD,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED,4EAA4E;IAC5E,KAAK,CAAC,YAAY,CAChB,IAAY,EACZ,IAAa,EACb,QAAiB;QAEjB,MAAM,IAAI,GAAG,CAAC,MAAM,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;QAC3C,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACjB;QACD,IAAI,QAAQ,EAAE;YACZ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;SAC3B;QACD,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED,mFAAmF;IACnF,KAAK,CAAC,QAAQ,CAAC,MAAc,EAAE,MAAc;QAC3C,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,cAAc,MAAM,EAAE,CAAC,CAAC;IAC1E,CAAC;IAED,oDAAoD;IAC5C,KAAK,CAAC,GAAG,CAAC,GAAG,IAAc;QACjC,OAAO,IAAA,YAAK,EAAC,KAAK,EAAE,IAAI,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC;IAC7C,CAAC;CACF;AA/GD,0BA+GC","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n * Licensed under the MIT License.\n *\n * Git operations module. Provides a typed wrapper around git CLI commands.\n * Simplified from fork-sync/src/modules/git.ts.\n *\n * @format\n */\n\nimport {spawn} from './proc';\n\n/**\n * Typed wrapper around a git repository directory.\n * All methods execute git commands with cwd set to the wrapped directory.\n */\nexport class GitRepo {\n  readonly dir: string;\n\n  constructor(dir: string) {\n    this.dir = dir;\n  }\n\n  /** Fetch from a remote. */\n  async fetch(remote: string): Promise<void> {\n    await this.git('fetch', remote);\n  }\n\n  /** Checkout an existing ref (branch, tag, or commit). */\n  async checkout(ref: string): Promise<void> {\n    await this.git('checkout', ref);\n  }\n\n  /**\n   * Create or reset a branch to a start point.\n   * Uses `git checkout -B` which creates the branch if it doesn't exist,\n   * or resets it if it does.\n   */\n  async checkoutNewBranch(name: string, startPoint?: string): Promise<void> {\n    const args = ['checkout', '-B', name];\n    if (startPoint) {\n      args.push(startPoint);\n    }\n    await this.git(...args);\n  }\n\n  /** Stage all changes (git add --all). */\n  async stageAll(): Promise<void> {\n    await this.git('add', '--all');\n  }\n\n  /** Create a commit with the given message. */\n  async commit(message: string): Promise<void> {\n    await this.git('commit', '-m', message);\n  }\n\n  /** Push a branch to a remote, optionally with --force. */\n  async push(\n    remote: string,\n    branch: string,\n    opts?: {force?: boolean},\n  ): Promise<void> {\n    const args = ['push', remote, branch];\n    if (opts?.force) {\n      args.push('--force');\n    }\n    await this.git(...args);\n  }\n\n  /** Resolve a ref to its SHA (git rev-parse). */\n  async revParse(ref: string): Promise<string> {\n    return this.git('rev-parse', ref);\n  }\n\n  /** Get the current branch name, or 'HEAD' if in detached state. */\n  async currentBranch(): Promise<string> {\n    return this.git('rev-parse', '--abbrev-ref', 'HEAD');\n  }\n\n  /** Check for uncommitted changes (git status --porcelain). */\n  async statusPorcelain(pathspec?: string): Promise<string> {\n    const args = ['status', '--porcelain'];\n    if (pathspec) {\n      args.push('--', pathspec);\n    }\n    return this.git(...args);\n  }\n\n  /** List all remotes with their URLs (git remote -v). */\n  async remoteList(): Promise<string> {\n    return this.git('remote', '-v');\n  }\n\n  /** Git log with format and optional range. */\n  async log(opts: {format: string; range?: string}): Promise<string> {\n    const args = ['log', `--format=${opts.format}`];\n    if (opts.range) {\n      args.push(opts.range);\n    }\n    return this.git(...args);\n  }\n\n  /** Get file names changed between two refs, optionally filtered by path. */\n  async diffNameOnly(\n    ref1: string,\n    ref2?: string,\n    pathspec?: string,\n  ): Promise<string> {\n    const args = ['diff', '--name-only', ref1];\n    if (ref2) {\n      args.push(ref2);\n    }\n    if (pathspec) {\n      args.push('--', pathspec);\n    }\n    return this.git(...args);\n  }\n\n  /** Check if a branch exists on a remote. Returns the ls-remote output or empty. */\n  async lsRemote(remote: string, branch: string): Promise<string> {\n    return this.git('ls-remote', '--heads', remote, `refs/heads/${branch}`);\n  }\n\n  /** Internal helper: run git with the repo's cwd. */\n  private async git(...args: string[]): Promise<string> {\n    return spawn('git', args, {cwd: this.dir});\n  }\n}\n"]}