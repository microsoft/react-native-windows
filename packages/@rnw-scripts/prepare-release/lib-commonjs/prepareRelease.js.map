{"version":3,"file":"prepareRelease.js","sourceRoot":"","sources":["../src/prepareRelease.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n * Licensed under the MIT License.\n *\n * This script automates the version bump PR workflow. It checks for pending\n * beachball change files, bumps versions, and creates or updates a\n * \"Version Packages\" pull request.\n *\n * Usage:\n *   npx prepare-release --branch <target> [--dry-run] [--no-color] [--help]\n *\n * @format\n */\n\nimport {parseArgs} from 'node:util';\nimport fs from 'fs';\nimport path from 'path';\n\nimport findRepoRoot from '@react-native-windows/find-repo-root';\n\nimport {GitRepo} from './git';\nimport {findPR, createPR, updatePR} from './github';\nimport {hasChangeFiles, bumpVersions} from './beachballBump';\nimport {\n  collectBumpedPackages,\n  generatePRBody,\n  generateConsoleSummary,\n} from './releaseSummary';\n\n// ---------------------------------------------------------------------------\n// Color utilities (from npmPack.js pattern)\n// ---------------------------------------------------------------------------\n\nconst ansi = {\n  reset: '\\x1b[0m',\n  bright: '\\x1b[1m',\n  dim: '\\x1b[2m',\n  red: '\\x1b[31m',\n  green: '\\x1b[32m',\n  yellow: '\\x1b[33m',\n  blue: '\\x1b[34m',\n  cyan: '\\x1b[36m',\n  gray: '\\x1b[90m',\n};\n\nlet useColors = true;\n\nfunction colorize(text: string, color: string): string {\n  if (!useColors) {\n    return text;\n  }\n  return color + text + ansi.reset;\n}\n\n// ---------------------------------------------------------------------------\n// CLI help\n// ---------------------------------------------------------------------------\n\nfunction showHelp(): void {\n  console.log(`\nprepare-release - Automate version bump PRs using beachball\n\nUsage:\n  npx prepare-release --branch <target> [options]\n\nOptions:\n  --branch <name>   Target branch to prepare release for (required)\n  --dry-run         Do everything except push and PR create/update\n  --no-color        Disable colored output\n  --help, -h        Show this help message\n\nExamples:\n  npx prepare-release --branch main\n  npx prepare-release --branch 0.76-stable --dry-run\n`);\n}\n\n// ---------------------------------------------------------------------------\n// Remote detection\n// ---------------------------------------------------------------------------\n\n/**\n * Normalize a git URL to a canonical form for comparison.\n *\n * Handles SSH (git@github.com:org/repo.git), HTTPS, with/without .git suffix.\n * Output: lowercase \"github.com/org/repo\"\n */\nfunction normalizeGitUrl(url: string): string {\n  let normalized = url;\n\n  // Strip trailing .git\n  normalized = normalized.replace(/\\.git$/, '');\n\n  // Convert SSH format: git@github.com:org/repo -> github.com/org/repo\n  normalized = normalized.replace(/^git@([^:]+):/, '$1/');\n\n  // Convert HTTPS format: https://github.com/org/repo -> github.com/org/repo\n  normalized = normalized.replace(/^https?:\\/\\//, '');\n\n  // Lowercase for case-insensitive comparison\n  normalized = normalized.toLowerCase();\n\n  // Strip trailing slash\n  normalized = normalized.replace(/\\/$/, '');\n\n  return normalized;\n}\n\n/**\n * Extract \"owner/repo\" from a git URL for use with `gh --repo`.\n *\n * E.g. \"git@github.com:microsoft/react-native-windows.git\"\n *   -> \"microsoft/react-native-windows\"\n */\nfunction extractGitHubRepo(url: string): string {\n  const normalized = normalizeGitUrl(url);\n  // normalized is like \"github.com/owner/repo\"\n  const match = normalized.match(/github\\.com\\/(.+)/);\n  if (!match) {\n    throw new Error(`Could not extract GitHub owner/repo from \"${url}\"`);\n  }\n  return match[1];\n}\n\n/**\n * Detect which git remote matches the repository URL from package.json.\n *\n * Parses `git remote -v` output and matches against the normalized repo URL.\n * On CI this is typically \"origin\"; on developer machines it may differ.\n */\nasync function detectRemote(\n  git: GitRepo,\n  repoUrl: string,\n): Promise<string> {\n  const canonical = normalizeGitUrl(repoUrl);\n  const remoteOutput = await git.remoteList();\n\n  for (const line of remoteOutput.split('\\n')) {\n    // Lines: \"origin\\thttps://github.com/microsoft/react-native-windows.git (fetch)\"\n    const match = line.match(/^(\\S+)\\s+(\\S+)\\s+\\(fetch\\)/);\n    if (!match) {\n      continue;\n    }\n    const remoteName = match[1];\n    const remoteUrl = match[2];\n\n    if (normalizeGitUrl(remoteUrl) === canonical) {\n      return remoteName;\n    }\n  }\n\n  throw new Error(\n    `Could not find a git remote matching \"${repoUrl}\". ` +\n      'Run \"git remote -v\" and verify the repository URL in root package.json.',\n  );\n}\n\n// ---------------------------------------------------------------------------\n// Main\n// ---------------------------------------------------------------------------\n\n(async () => {\n  // 1. Parse CLI arguments\n  const {values} = parseArgs({\n    options: {\n      branch: {type: 'string'},\n      'dry-run': {type: 'boolean', default: false},\n      help: {type: 'boolean', short: 'h', default: false},\n      'no-color': {type: 'boolean', default: false},\n    },\n  });\n\n  if (values.help) {\n    showHelp();\n    process.exit(0);\n  }\n\n  useColors = !values['no-color'];\n\n  const targetBranch = values.branch;\n  if (!targetBranch) {\n    console.error(colorize('Error: --branch is required', ansi.red));\n    showHelp();\n    process.exit(1);\n  }\n\n  const dryRun = values['dry-run'] ?? false;\n\n  if (dryRun) {\n    console.log(colorize('[DRY RUN MODE]', ansi.yellow));\n  }\n\n  try {\n    // 2. Find repo root\n    const repoRoot = await findRepoRoot();\n    console.log(`${colorize('Repository root:', ansi.bright)} ${repoRoot}`);\n\n    // 3. Read repository URL from root package.json\n    const rootPkgJsonPath = path.join(repoRoot, 'package.json');\n    const rootPkgJson = JSON.parse(fs.readFileSync(rootPkgJsonPath, 'utf8'));\n    const repoUrl: string = rootPkgJson.repository?.url ?? '';\n\n    if (!repoUrl) {\n      throw new Error(\n        'Could not find repository.url in root package.json',\n      );\n    }\n    console.log(`${colorize('Repository URL:', ansi.bright)} ${repoUrl}`);\n\n    // 4. Detect git remote name\n    const git = new GitRepo(repoRoot);\n    const remoteName = await detectRemote(git, repoUrl);\n    console.log(`${colorize('Git remote:', ansi.bright)} ${remoteName}`);\n\n    // 4b. Extract GitHub owner/repo for gh CLI --repo flag\n    const githubRepo = extractGitHubRepo(repoUrl);\n    console.log(`${colorize('GitHub repo:', ansi.bright)} ${githubRepo}`);\n\n    // 5. Fetch from remote\n    console.log(colorize(`Fetching from ${remoteName}...`, ansi.dim));\n    await git.fetch(remoteName);\n\n    // 6. Check for pending change files\n    console.log(colorize('Checking for change files...', ansi.dim));\n    if (!hasChangeFiles(repoRoot)) {\n      console.log(\n        colorize('No pending change files found. Nothing to do.', ansi.green),\n      );\n      process.exit(0);\n    }\n    console.log(colorize('Found pending change files.', ansi.green));\n\n    // 7. Check for existing PR\n    const prBranch = `prepare-release/${targetBranch}`;\n    console.log(\n      colorize(`Looking for existing PR from ${prBranch}...`, ansi.dim),\n    );\n    const existingPR = await findPR({\n      head: prBranch,\n      cwd: repoRoot,\n      repo: githubRepo,\n    });\n\n    if (existingPR) {\n      console.log(\n        `${colorize('Found existing PR:', ansi.bright)} #${existingPR.number} (${existingPR.url})`,\n      );\n    } else {\n      console.log(\n        colorize('No existing PR found. Will create one.', ansi.dim),\n      );\n    }\n\n    // 8. Save original branch so we can restore it when done\n    const originalBranch = await git.currentBranch();\n    console.log(\n      colorize(`Saving current branch: ${originalBranch}`, ansi.dim),\n    );\n\n    try {\n      // 9. Create/reset the prepare-release branch from target branch HEAD\n      console.log(\n        colorize(\n          `Creating branch ${prBranch} from ${remoteName}/${targetBranch}...`,\n          ansi.dim,\n        ),\n      );\n      await git.checkoutNewBranch(prBranch, `${remoteName}/${targetBranch}`);\n\n      // 10. Run beachball bump\n      console.log(colorize('Running beachball bump...', ansi.bright));\n      await bumpVersions({\n        targetBranch,\n        remote: remoteName,\n        cwd: repoRoot,\n      });\n\n      // 11. Check if beachball actually changed anything\n      const status = await git.statusPorcelain();\n      if (!status) {\n        console.log(\n          colorize(\n            'beachball bump made no changes. Nothing to commit.',\n            ansi.yellow,\n          ),\n        );\n        process.exit(0);\n      }\n\n      // 12. Collect bumped package info for PR description\n      //     Parse changed package.json paths from git status --porcelain output\n      const changedFiles = status\n        .split('\\n')\n        .map(line => line.trim().split(/\\s+/).pop()!)\n        .filter(f => f.endsWith('package.json'));\n\n      const bumpedPackages = collectBumpedPackages(changedFiles, repoRoot);\n      console.log(generateConsoleSummary(bumpedPackages));\n\n      // 13. Stage all + commit\n      const commitMessage = `Version Packages (${targetBranch})`;\n      console.log(colorize(`Committing: \"${commitMessage}\"...`, ansi.dim));\n      await git.stageAll();\n      await git.commit(commitMessage);\n\n      // 14. Force-push the branch\n      if (dryRun) {\n        console.log(\n          colorize(\n            `[DRY RUN] Would force-push ${prBranch} to ${remoteName}`,\n            ansi.yellow,\n          ),\n        );\n      } else {\n        console.log(\n          colorize(\n            `Force-pushing ${prBranch} to ${remoteName}...`,\n            ansi.dim,\n          ),\n        );\n        await git.push(remoteName, prBranch, {force: true});\n\n        // Verify the branch landed on the remote\n        const lsRemoteOut = await git.lsRemote(remoteName, prBranch);\n        if (!lsRemoteOut) {\n          throw new Error(\n            `Push verification failed: branch \"${prBranch}\" not found on ` +\n              `\"${remoteName}\" after push. Check your push permissions.`,\n          );\n        }\n        console.log(\n          colorize(\n            `Push verified: ${prBranch} exists on ${remoteName}`,\n            ansi.green,\n          ),\n        );\n      }\n\n      // 15. Create or update PR\n      const prTitle = `Version Packages (${targetBranch})`;\n      const prBody = generatePRBody(targetBranch, bumpedPackages);\n\n      if (existingPR) {\n        if (dryRun) {\n          console.log(\n            colorize(\n              `[DRY RUN] Would update PR #${existingPR.number}`,\n              ansi.yellow,\n            ),\n          );\n        } else {\n          console.log(\n            colorize(`Updating PR #${existingPR.number}...`, ansi.dim),\n          );\n          await updatePR({\n            number: existingPR.number,\n            body: prBody,\n            cwd: repoRoot,\n            repo: githubRepo,\n          });\n          console.log(\n            `${colorize('PR updated:', ansi.green)} ${existingPR.url}`,\n          );\n        }\n      } else {\n        if (dryRun) {\n          console.log(\n            colorize(\n              `[DRY RUN] Would create PR: \"${prTitle}\"`,\n              ansi.yellow,\n            ),\n          );\n        } else {\n          console.log(colorize('Creating pull request...', ansi.dim));\n          const newPR = await createPR({\n            head: prBranch,\n            base: targetBranch,\n            title: prTitle,\n            body: prBody,\n            cwd: repoRoot,\n            repo: githubRepo,\n          });\n          console.log(\n            `${colorize('PR created:', ansi.green)} ${newPR.url}`,\n          );\n        }\n      }\n\n      // 16. Done\n      console.log('');\n      console.log(colorize('Done!', ansi.green + ansi.bright));\n\n      if (dryRun) {\n        console.log(colorize('\\nPR body that would be used:', ansi.dim));\n        console.log(prBody);\n      }\n    } finally {\n      // Always restore the original branch\n      if (originalBranch && originalBranch !== 'HEAD') {\n        console.log(\n          colorize(\n            `Restoring original branch: ${originalBranch}`,\n            ansi.dim,\n          ),\n        );\n        await git.checkout(originalBranch);\n      }\n    }\n  } catch (err) {\n    const message = err instanceof Error ? err.message : String(err);\n    console.error(`${colorize('Error:', ansi.red)} ${message}`);\n    process.exit(1);\n  }\n})();\n"]}