<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Using CodePush in a React Native for Windows application · React Native for Windows + macOS</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;head&gt;"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Using CodePush in a React Native for Windows application · React Native for Windows + macOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://microsoft.github.io/react-native-windows/blog/2021/05/17/codepush"/><meta property="og:description" content="&lt;head&gt;"/><meta property="og:image" content="https://microsoft.github.io/react-native-windows/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://microsoft.github.io/react-native-windows/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/react-native-windows/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"/><link rel="stylesheet" href="/react-native-windows/css/code-block-buttons.css"/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/react-native-windows/js/code-block-buttons.js"></script><script type="text/javascript" src="/react-native-windows/js/nav-buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/react-native-windows/js/scrollSpy.js"></script><link rel="stylesheet" href="/react-native-windows/css/prism.css"/><link rel="stylesheet" href="/react-native-windows/css/main.css"/><script src="/react-native-windows/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/react-native-windows/"><img class="logo" src="/react-native-windows/img/header_logo.svg" alt="React Native for Windows + macOS"/><h2 class="headerTitleWithLogo">React Native for Windows + macOS</h2></a><a href="/react-native-windows/versions"><h3>0.79</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/react-native-windows/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/react-native-windows/docs/flyout-component" target="_self">APIs</a></li><li class=""><a href="https://devblogs.microsoft.com/react-native/" target="_self">Blog</a></li><li class=""><a href="/react-native-windows/resources" target="_self">Resources</a></li><li class=""><a href="https://github.com/microsoft/react-native-windows-samples/tree/main/samples" target="_self">Samples</a></li><li class=""><a href="/react-native-windows/support" target="_self">Support</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2022/07/29/coreapp">Streamlining app creation with React Native for Windows CoreApp</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2022/02/11/settings">React Native for Windows is helping Settings improve more quickly</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2022/02/11/rnwinrt">Calling Windows APIs from React Native just got easier</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2021/08/05/win32component">Use Win32 features from a React Native for Windows application</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2021/06/30/notifications">Add Toast notifications to your React Native for Windows application</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/react-native-windows/blog/2021/05/17/codepush">Using CodePush in a React Native for Windows application</a></h1><p class="post-meta">May 17, 2021</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/ReactNativeMSFT" target="_blank" rel="noreferrer noopener">Matteo Pagani</a></p></div></header><div><span><p><head>
<meta http-equiv="Refresh" content="0; URL=https://devblogs.microsoft.com/react-native/rnw-codepush/" />
</head></p>
<p>CodePush is a service built by Microsoft, now incorporated into the <a href="https://appcenter.ms/">Visual Studio App Center platform</a>, which provides a way for React Native and Cordova developers to be more agile in delivering updates to their applications.
Thanks to CodePush, you are able to deliver a new bundle (which might contain updated JavaScript files, new images, etc.) without having to fully redeploy a new package. This means, for example, that you can update the content of your application published on a Store without submitting a new package and waiting for the certification process to be completed; or that you can add a new feature in your LOB app without having to redeploy it via Intune or another MDM solution to all your employees.</p>
<!--truncate-->
<p>The only caveat is that <strong>the feature works only for updates which involves the bundle</strong>, which means changes in the JavaScript code, a new asset, etc. If the update involves changes in the binary package (like adding a new capability in the manifest or integrating a new native module), then you are required to submit a new package using the standard approach.</p>
<p>Enabling Code Push requires to interact with three different layers:</p>
<ol>
<li>App Center, which is the cloud platform that will host and deliver your updates. You're going to push new bundles to App Center using the <a href="https://docs.microsoft.com/appcenter/cli/">App Center CLI</a>.</li>
<li>A native module, which must be integrated in the React Native application.</li>
<li>A set of JavaScript APIs, which you must integrate in the JavaScript layer of your application to manage the update lifecycle.</li>
</ol>
<p>CodePush initially supported only iOS and Android, but <a href="https://github.com/microsoft/react-native-code-push/">the native module</a> has recently added support for the Windows implementation of React Native as well. However, App Center still lacks support for this technology on Windows and, today, when you create a new Windows application on App Center, React Native isn't one of the available options. This means that the infrastructure needed to support CodePush won't be available. In this article we're going to see how we can configure our Windows application to use Code Push, even if it isn't fully supported by App Center.</p>
<h2><a class="anchor" aria-hidden="true" id="setting-up-app-center"></a><a href="#setting-up-app-center" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up App Center</h2>
<p>The first task is to create a new application in Visual Studio App Center. Thes starting point is the <a href="https://appcenter.ms/">App Center website</a>, where you can login to your dashboard. If you don't already have an account, you can create a free one the first time you login using your Microsoft Account, work account, GitHub, Facebook or Google account.
Once you are logged in, click on <strong>Add new</strong> and choose <strong>Add new app</strong>.</p>
<p>This is the first step where we have to apply a workaround. In this panel, you will be able to setup your application, by specifing the name and the target platform:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/NewApp.png" alt=""></p>
<p>However, as previously mentioned, if you choose <strong>Windows</strong> you won't see React Native as an option. As such, we have to trick App Center to think that our Windows application is actually an Android one.</p>
<blockquote>
<p>The process will work also if you choose iOS. Since we won't really use any specific Android or iOS SDK, it doesn't really matter, as long as React Native is a supported platform.</p>
</blockquote>
<p>As such, choose <strong>Android</strong> as OS and <strong>React Native</strong> as Platform, then create the application. Since you have chosen React Native, you should see now a section called <strong>CodePush</strong> in the Distribute section:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/CodePush-AppCenter.png" alt=""></p>
<p>In CodePush you can configure multiple deployments slot, to manage different versions of the application (production, staging, etc.). By clicking on <strong>Create standard deployments</strong> App Center will create by defaults two environments: Staging and Production. By clicking on the wrench icon at the top, you will be able to add new ones.
Each environment has a dedicated key, which is required to setup CodePush in the application. For the moment, let's assume that we're going to work with the staging version of the app, so copy the key for that environment and keep it for the next steps.</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/Environments.png" alt=""></p>
<p>The last step is to install the App Center CLI, which provides the commands you will need to push the bundle updates to the App Center servers. To install it, open a prompt on your machine and run the following command:</p>
<pre><code class="hljs css language-powershell">npm install <span class="hljs-literal">-g</span> appc<span class="hljs-built_in">enter-cli</span>
</code></pre>
<p>Before moving to the next step, run the following command to login with your App Center account and connect the CLI to it:</p>
<pre><code class="hljs css language-powershell">appcenter login
</code></pre>
<p>Now we can start integrating the SDK in our React Native app.</p>
<h2><a class="anchor" aria-hidden="true" id="integrating-the-sdk"></a><a href="#integrating-the-sdk" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integrating the SDK</h2>
<p>The SDK is available as a React Native native module, which fully supports autolinking on Windows as well. As such, the first step is to install the module. Move to the root of your React Native project and run the following command in a terminal:</p>
<pre><code class="hljs css language-powershell">yarn add react<span class="hljs-literal">-native</span><span class="hljs-literal">-code</span><span class="hljs-literal">-push</span>
</code></pre>
<p>The next step is to perform the autolinking. We have to do it manually because, after the module has been linked, we'll have to make some manual changes to the app before being able to build and deploy it. As such, from the same root of the project, run the following command:</p>
<pre><code class="hljs css language-powershell">npx react<span class="hljs-literal">-native</span> autolink<span class="hljs-literal">-windows</span>
</code></pre>
<p>Now open in Visual Studio the solution in the <strong>windows</strong> folder (it will have the same name of your project, plus the .sln extension).
If you have performed the autolinking properly, the solution will look like this:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/SolutionExplorer.png" alt=""></p>
<p>In the previous image, <strong>codepushsample</strong> is the main application which acts as a React Native host (in this case it's based on C#, but it can be C++ as well), while <strong>CodePush</strong> is the SDK referenced by the main app.
The next step is to change the implementation of the <code>OnLaunched</code> event, which takes care of initializing the app. <strong>This is a very important step</strong>: it won't be enough to add the code to initialize CodePush, but you have also to make the below changes in the initialization; otherwise, the application won't behave properly and, most of the times, launching it will result in a blank screen or a frozen app.</p>
<p>If you have opted for an host application based on C# (so you have initialized React Native for Windows with the <code>--language cs</code> parameter), you will find the <code>OnLaunched</code> implementation in the <code>App.xaml.cs</code> file. You will have to replace it with the following code:</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnLaunched</span><span class="token punctuation">(</span><span class="token class-name">LaunchActivatedEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Microsoft<span class="token punctuation">.</span>CodePush<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>CodePushConfig<span class="token punctuation">.</span><span class="token function">SetHost</span><span class="token punctuation">(</span>Host<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> configMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configMap<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"appVersion"</span><span class="token punctuation">,</span> <span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configMap<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"deploymentKey"</span><span class="token punctuation">,</span> <span class="token string">"&lt;deploymentKey>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Microsoft<span class="token punctuation">.</span>CodePush<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>CodePushConfig<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>configMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Frame</span> rootFrame <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> Window<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Content<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        rootFrame <span class="token operator">=</span> content <span class="token keyword">as</span> <span class="token class-name">Frame</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>rootFrame <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        rootFrame <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Frame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>PreviousExecutionState <span class="token operator">==</span> ApplicationExecutionState<span class="token punctuation">.</span>Terminated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>PrelaunchActivated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rootFrame<span class="token punctuation">.</span>Content <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                rootFrame<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MainPage</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Window<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Content <span class="token operator">=</span> rootFrame<span class="token punctuation">;</span>
            Window<span class="token punctuation">.</span>Current<span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>PrelaunchActivated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rootFrame<span class="token punctuation">.</span>Content <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                rootFrame<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MainPage</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Window<span class="token punctuation">.</span>Current<span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If, instead, you're using a C++ host (the default one), you will find the implementation in the <strong>App.cpp</strong> file. This is the new implementation you have to provide:</p>
<pre><code class="hljs css language-cpp"><span class="token keyword">void</span> <span class="token class-name">App</span><span class="token double-colon punctuation">::</span><span class="token function">OnLaunched</span><span class="token punctuation">(</span>activation<span class="token double-colon punctuation">::</span>LaunchActivatedEventArgs <span class="token keyword">const</span><span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    winrt<span class="token double-colon punctuation">::</span>Microsoft<span class="token double-colon punctuation">::</span>CodePush<span class="token double-colon punctuation">::</span>ReactNative<span class="token double-colon punctuation">::</span><span class="token class-name">CodePushConfig</span><span class="token double-colon punctuation">::</span><span class="token function">SetHost</span><span class="token punctuation">(</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> configMap<span class="token punctuation">{</span> winrt<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">single_threaded_map</span><span class="token generic class-name"><span class="token operator">&lt;</span>hstring<span class="token punctuation">,</span> hstring<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    configMap<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>L<span class="token string">"appVersion"</span><span class="token punctuation">,</span> L<span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configMap<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>L<span class="token string">"deploymentKey"</span><span class="token punctuation">,</span> L<span class="token string">"&lt;deploymentKey>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    winrt<span class="token double-colon punctuation">::</span>Microsoft<span class="token double-colon punctuation">::</span>CodePush<span class="token double-colon punctuation">::</span>ReactNative<span class="token double-colon punctuation">::</span><span class="token class-name">CodePushConfig</span><span class="token double-colon punctuation">::</span><span class="token function">Init</span><span class="token punctuation">(</span>configMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Frame rootFrame<span class="token punctuation">{</span> <span class="token keyword">nullptr</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> content <span class="token operator">=</span> <span class="token class-name">Window</span><span class="token double-colon punctuation">::</span><span class="token function">Current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        rootFrame <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">try_as</span><span class="token generic class-name"><span class="token operator">&lt;</span>Frame<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Do not repeat app initialization when the Window already has content,</span>
    <span class="token comment">// just ensure that the window is active</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rootFrame <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Create a Frame to act as the navigation context and associate it with</span>
        <span class="token comment">// a SuspensionManager key</span>
        rootFrame <span class="token operator">=</span> <span class="token function">Frame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rootFrame<span class="token punctuation">.</span><span class="token function">NavigationFailed</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>App<span class="token double-colon punctuation">::</span>OnNavigationFailed <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">PreviousExecutionState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ApplicationExecutionState<span class="token double-colon punctuation">::</span>Terminated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Restore the saved session state only when appropriate, scheduling the</span>
            <span class="token comment">// final launch steps after the restore is complete</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">PrelaunchActivated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rootFrame<span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// When the navigation stack isn't restored navigate to the first page,</span>
                <span class="token comment">// configuring the new page by passing required information as a navigation</span>
                <span class="token comment">// parameter</span>
                rootFrame<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">xaml_typename</span><span class="token generic class-name"><span class="token operator">&lt;</span>CodePushDemoAppCpp<span class="token double-colon punctuation">::</span>MainPage<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">box_value</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">Arguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Place the frame in the current Window</span>
            <span class="token class-name">Window</span><span class="token double-colon punctuation">::</span><span class="token function">Current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span>rootFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Ensure the current window is active</span>
            <span class="token class-name">Window</span><span class="token double-colon punctuation">::</span><span class="token function">Current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">PrelaunchActivated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rootFrame<span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// When the navigation stack isn't restored navigate to the first page,</span>
                <span class="token comment">// configuring the new page by passing required information as a navigation</span>
                <span class="token comment">// parameter</span>
                rootFrame<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">xaml_typename</span><span class="token generic class-name"><span class="token operator">&lt;</span>CodePushDemoAppCpp<span class="token double-colon punctuation">::</span>MainPage<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">box_value</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">Arguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Ensure the current window is active</span>
            <span class="token class-name">Window</span><span class="token double-colon punctuation">::</span><span class="token function">Current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can copy and paste both snippets of code as they are. The only change to apply is in the first lines, where the CodePush initialization happens:</p>
<pre><code class="hljs css language-csharp">Microsoft<span class="token punctuation">.</span>CodePush<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>CodePushConfig<span class="token punctuation">.</span><span class="token function">SetHost</span><span class="token punctuation">(</span>Host<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> configMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
configMap<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"appVersion"</span><span class="token punctuation">,</span> <span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
configMap<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"deploymentKey"</span><span class="token punctuation">,</span> <span class="token string">"&lt;deploymentKey>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Microsoft<span class="token punctuation">.</span>CodePush<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>CodePushConfig<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>configMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>appVersion</code> is the version number of the application and it's used to determine if CodePush should deliver an update or not for this version. When you publish a bundle on CodePush, in fact, you can specify which is the version of the application the bundle refers to, so that only users with that version will receive the update. <code>deploymentKey</code>, instead, is the key we have previously retrieved from App Center.</p>
<p>That's it. Now you can deploy and run the application like a normal React Native for Windows application. You won't see any changes for the moment.
However, be aware that, in order to test the implementation, <strong>you won't be able to use a debug version of the app</strong>, but you will have to generate a release AppX / MSIX package and deploy it on your machine.
The reason is that, when you're debugging a React Native application, the Metro packager is always up &amp; running. As such, any change you're going to make to the JavaScript layer will be automatically pushed to the host app and displayed in real time, without giving you the possibility to push it as an update via CodePush.</p>
<p>To generate a relase version of the package, you can follow <a href="https://microsoft.github.io/react-native-windows/docs/getting-started#building-a-standalone-react-native-windows-app">this guidance</a>.</p>
<p><strong>Important!</strong> Before generating a release package, open the manifest of the app (double click on the Package.appxmanifest file in Visual Studio), move to the <strong>Packaging</strong> section and change the <strong>Package name</strong> field to a more friendly name.
By default, the package name assigned to a new UWP app is a GUID, which makes the <strong>Package Family Name</strong> (the unique identifier of a packaged app) very long. Since the Package Family Name is used also to generate the folder where Windows stores the local data (including the updates downloaded from App Center), a very long name could lead CodePush to break and you might get errors like <code>The filename or extension is too long</code> when the updated bundle is being installed.</p>
<h2><a class="anchor" aria-hidden="true" id="integrating-the-javascript-apis"></a><a href="#integrating-the-javascript-apis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integrating the JavaScript APIs</h2>
<p>Now we are ready to start setting up CodePush in the JavaScript layer of the application. The key to enable it is to wrap the main <code>App</code> class or function (based on the approach you're using) inside the <code>codePush</code> one, like in the following examples:</p>
<pre><code class="hljs css language-javascript"><span class="token comment">//class component</span>
<span class="token keyword">import</span> codePush <span class="token keyword">from</span> <span class="token string">"react-native-code-push"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// your app component</span>
<span class="token punctuation">}</span>

App <span class="token operator">=</span> <span class="token function">codePush</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

<span class="token comment">//functional component</span>
<span class="token keyword">import</span> codePush <span class="token keyword">from</span> <span class="token string">"react-native-code-push"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">App</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">React$Node</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">//your app component</span>
<span class="token punctuation">}</span>

App <span class="token operator">=</span> <span class="token function">codePush</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
<p>With this basic configuration you enable the default behavior: CodePush will search for updates when the application starts and, if they're available, it will download them silently and apply them at the next restart.
Let's try it. As first step, after you have wrapped your application in the <code>codePush</code> function, you will have to generate, through Visual Studio, a new MSIX / AppX package compiled in Release mode and then install it on your machine.
Once you have it, you can start making changes to your application. Feel free to change anything which involves the JavaScript layer: a text, a style, a component, etc.</p>
<p>Once you have made the change, you will need to create a new bundle and release it on CodePush. If you follow the official guidance, you'll find that the App Center CLI has a special command called <code>release-react</code> which automatically takes care of generating the bundle and pushing it to CodePush. However, at the time of writing, the App Center CLI doesn't support Windows as a platform yet. As such, the <code>release-react</code> will generate an incorrect bundle: since, in App Center, you have configured this app as an Android app, it will generate an Android bundle.</p>
<p>The workaround is to manually generate the bundle for Windows and then manually upload it to CodePush, using the <code>release</code> command. Let's start with the first step. Open a terminal on the root of your project and create a folder called <code>Bundle</code> to store it:</p>
<pre><code class="hljs css language-powershell">mkdir Bundle
</code></pre>
<p>Then run the following command:</p>
<pre><code class="hljs css language-powershell">npx -<span class="hljs-literal">-no</span><span class="hljs-literal">-install</span> react<span class="hljs-literal">-native</span> bundle -<span class="hljs-literal">-platform</span> windows -<span class="hljs-literal">-entry</span><span class="hljs-operator">-file</span> index.js -<span class="hljs-literal">-bundle</span><span class="hljs-literal">-output</span> ./Bundle/index.windows.bundle -<span class="hljs-literal">-assets</span><span class="hljs-literal">-dest</span> ./Bundle -<span class="hljs-literal">-dev</span> false -<span class="hljs-literal">-reset</span><span class="hljs-literal">-cache</span>
</code></pre>
<p>This is the same command that Visual Studio runs when you generate a release package for the Windows application.
Now you can push it to App Center using the App Center CLI with the following command:</p>
<pre><code class="hljs css language-powershell">appcenter codepush release <span class="hljs-literal">-a</span> mpagani/CodePushSample <span class="hljs-literal">-c</span> .\Bundle <span class="hljs-literal">-t</span> <span class="hljs-number">1.0</span>.<span class="hljs-number">0</span>
</code></pre>
<p>This is the meaning of the various parameters:</p>
<ul>
<li><p><code>-a</code> is the identifier of application you have registed on App Center. The parameter is made by the name of your account / the name of the application. You can find them in your URL of your browser, when you have the dashboard opened on the app:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/url.png" alt=""></p></li>
<li><p><code>-c</code> is the path which contains the bundle you want to publish. In our case, it's the <code>Bundle</code> folder which we have previously created.</p></li>
<li><p><code>-t</code> is the version number of the app this bundle refers to.</p></li>
</ul>
<p>After a few seconds, you should see a confirmation that the bundle has been succesfully uploaded. You can check that the operation was succesfull by logging in to the App Center dashboard of your application. You should see all the releases you have published in the CodePush section:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/CodePush-Releases.png" alt=""></p>
<p>You will be able to see different statistics about each release, like the number of users who have downloaded and installed the update:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/ReleaseDetail.png" alt=""></p>
<p>Now you should be able to see CodePush in action by following these steps:</p>
<ol>
<li>Open the application you have previously packaged and deployed.</li>
<li>You will see the original version of the application. However, in background, CodePush will have started to download the new bundle.</li>
<li>Close and reopen the application.</li>
<li>Now you should see the new version of the application, with the changes you have applied.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="configure-the-update"></a><a href="#configure-the-update" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configure the update</h3>
<p>When you use the CLI, you can also configure how the update should behave with different parameters. For example, if it's a mandatory update (so the user can't ignore it or postpone it), you can use the <code>--mandatory</code> parameter:</p>
<pre><code class="hljs css language-powershell">appcenter codepush release <span class="hljs-literal">-a</span> mpagani/CodePushSample <span class="hljs-literal">-c</span> .\Bundle <span class="hljs-literal">-t</span> <span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> -<span class="hljs-literal">-mandatory</span>
</code></pre>
<p>Alternatively, if you want to enable a gradual rollout, you can use the <code>--rollout</code> parameter with a number between 1 and 100, which represents the percentage of users that will receive the update immediately:</p>
<pre><code class="hljs css language-powershell">appcenter codepush release <span class="hljs-literal">-a</span> mpagani/CodePushSample <span class="hljs-literal">-c</span> .\Bundle <span class="hljs-literal">-t</span> <span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> -<span class="hljs-literal">-rollout</span> <span class="hljs-number">25</span>
</code></pre>
<p>You can find all the parameters documented <a href="https://github.com/microsoft/code-push/tree/v3.0.1/cli#releasing-updates-general">here</a>. In case you have already pushed an update and you want to change its configuration, you can use the App Center dashboard. By clicking on the wrench icon inside a release page, you will be able to customize it:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/ConfigureUpdate.png" alt=""></p>
<h2><a class="anchor" aria-hidden="true" id="customizing-the-update-behavior"></a><a href="#customizing-the-update-behavior" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customizing the update behavior</h2>
<p>The CodePush APIs give you lot of flexibility in deciding how you want to manage updates. The previous implementation you have tested is the default one, but there are other alternatives.</p>
<h3><a class="anchor" aria-hidden="true" id="show-a-prompt-to-the-user"></a><a href="#show-a-prompt-to-the-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Show a prompt to the user</h3>
<p>With this approach, the check for updates still happens when the application starts, but the package won't be automatically downloaded and installed. The user will be prompted if they want to move on or cancel it (unless it was marked as mandatory when you have published the bundle).</p>
<p><img src="/react-native-windows/blog/assets/2021-05-17-codepush/UpdatePrompt.png" alt=""></p>
<p>To achieve this goal, you can pass the following options when you initialize the <code>codePush</code> function:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">import</span> codePush <span class="token keyword">from</span> <span class="token string">"react-native-code-push"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">App</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">React$Node</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">//your app component</span>
<span class="token punctuation">}</span>

App <span class="token operator">=</span> <span class="token function">codePush</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">updateDialog</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">installMode</span><span class="token operator">:</span> codePush<span class="token punctuation">.</span>InstallMode<span class="token punctuation">.</span><span class="token constant">IMMEDIATE</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="handle-updates-manually"></a><a href="#handle-updates-manually" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handle updates manually</h3>
<p>You can also choose to disable automatic updates and provide a manual way to the user to check and install them, for example via a button. The first step is to pass <code>CheckFrequency.MANUAL</code> as option in the <code>codePush()</code> function to disable automatic updates:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">import</span> codePush <span class="token keyword">from</span> <span class="token string">"react-native-code-push"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">App</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">React$Node</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">//your app component</span>
<span class="token punctuation">}</span>

App <span class="token operator">=</span> <span class="token function">codePush</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">checkFrequency</span><span class="token operator">:</span> codePush<span class="token punctuation">.</span>CheckFrequency<span class="token punctuation">.</span><span class="token constant">MANUAL</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
<p>Then you can use use the <code>sync()</code> function provided by the CodePush APIs to manually trigger the update check. You can call this function, for example, when a button is pressed:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">onCheckUpdates</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> codePush<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">updateDialog</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">installMode</span><span class="token operator">:</span> codePush<span class="token punctuation">.</span>InstallMode<span class="token punctuation">.</span><span class="token constant">IMMEDIATE</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="track-the-download-progress"></a><a href="#track-the-download-progress" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Track the download progress</h3>
<p>CodePush provides a series of events to track the status of the installation. The only caveat is that, at the moment of writing, they are exposed only through class components.
This is an example of the implementation:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">codePushStatusDidChange</span><span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> codePush<span class="token punctuation">.</span>SyncStatus<span class="token punctuation">.</span><span class="token constant">CHECKING_FOR_UPDATE</span><span class="token operator">:</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Checking for updates."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> codePush<span class="token punctuation">.</span>SyncStatus<span class="token punctuation">.</span><span class="token constant">DOWNLOADING_PACKAGE</span><span class="token operator">:</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Downloading update."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> codePush<span class="token punctuation">.</span>SyncStatus<span class="token punctuation">.</span><span class="token constant">INSTALLING_UPDATE</span><span class="token operator">:</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Installing update."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> codePush<span class="token punctuation">.</span>SyncStatus<span class="token punctuation">.</span><span class="token constant">UP_TO_DATE</span><span class="token operator">:</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Your app is up-to-date."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> codePush<span class="token punctuation">.</span>SyncStatus<span class="token punctuation">.</span><span class="token constant">UPDATE_INSTALLED</span><span class="token operator">:</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Update installed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">codePushDownloadDidProgress</span><span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>progress<span class="token punctuation">.</span>receivedBytes <span class="token operator">+</span> <span class="token string">" of "</span> <span class="token operator">+</span> progress<span class="token punctuation">.</span>totalBytes <span class="token operator">+</span> <span class="token string">" received."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
App <span class="token operator">=</span> <span class="token function">codePush</span><span class="token punctuation">(</span>MyApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
<p>The <code>codePushStatusDidChange()</code> event is raised when the status of the update changes. It can assume one of the values exposed by the <code>SyncStatus</code> enumerator. The <code>codePushDownloadDidProgress()</code> event, instead, is raised when the download has started and, through the <code>progress</code> object, you can get the current status, in case you want to display a progress bar or another similar control.</p>
<h2><a class="anchor" aria-hidden="true" id="wrapping-up"></a><a href="#wrapping-up" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Wrapping up</h2>
<p>Thanks to CodePush, you can be more agile in keeping your application up-to-date and deliver new features without having to redeploy a completely new package. Currently, a few workarounds are needed for App Center to integrate with the React Native for Windows implementation. I highly recommend you to read <a href="https://github.com/microsoft/react-native-code-push/blob/master/README.md">the whole README of the main repository</a>, since it contains a lot of additional information for advanced scenarios, like how to handle Store policies, how to manage multiple deployment assignments, etc.
<a href="https://github.com/microsoft/react-native-code-push/blob/master/docs/api-js.md">Here</a>, instead, you can find an overview of the JavaScript APIs, with many details on how to customize the update experience.
If you're looking for an example with a C++ based host app, you can refer to <a href="https://github.com/microsoft/react-native-code-push/tree/master/Examples/CodePushDemoApp">the official one</a>. A C# version of the sample, instead, can be found <a href="https://github.com/qmatteoq/CodePushSample">here</a>.</p>
<p>Happy coding!</p>
</span></div></div><div class="blogSocialSection"></div></div><div class="blog-recent"><a class="button" href="/react-native-windows/blog/">Recent Posts</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#setting-up-app-center">Setting up App Center</a></li><li><a href="#integrating-the-sdk">Integrating the SDK</a></li><li><a href="#integrating-the-javascript-apis">Integrating the JavaScript APIs</a><ul class="toc-headings"><li><a href="#configure-the-update">Configure the update</a></li></ul></li><li><a href="#customizing-the-update-behavior">Customizing the update behavior</a><ul class="toc-headings"><li><a href="#show-a-prompt-to-the-user">Show a prompt to the user</a></li><li><a href="#handle-updates-manually">Handle updates manually</a></li><li><a href="#track-the-download-progress">Track the download progress</a></li></ul></li><li><a href="#wrapping-up">Wrapping up</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>React Native Docs</h5><a href="https://reactnative.dev/docs/getting-started">Getting Started</a><a href="https://reactnative.dev/docs/tutorial">Tutorial</a><a href="https://reactnative.dev/docs/components-and-apis">Components and APIs</a><a href="https://reactnative.dev/docs/more-resources">More Resources</a></div><div><h5>React Native for Windows + macOS Docs</h5><div style="color:white;font-weight:500;font-size:16px"><a href="/react-native-windows/docs/getting-started">Get Started with Windows</a></div><div style="color:white;font-weight:500;font-size:16px"><a href="/react-native-windows/docs/rnm-getting-started"> Get Started with macOS</a></div><a href="/react-native-windows/docs/parity-status">React Native Windows Components and APIs</a><a href="/react-native-windows/docs/native-modules">Native Modules</a><a href="/react-native-windows/docs/view-managers">Native UI Components</a></div><div><h5>Connect With Us On</h5><a href="https://devblogs.microsoft.com/react-native/">Blog</a><a href="https://twitter.com/ReactNativeMSFT" target="_blank">Twitter</a><a href="https://github.com/microsoft/react-native-windows" target="_blank">GitHub</a><a href="https://github.com/microsoft/react-native-windows-samples/tree/main/samples" target="_blank">Samples</a></div></section></footer></div></body></html>