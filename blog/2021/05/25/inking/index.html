<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Add inking to your React Native for Windows application · React Native for Windows + macOS</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;head&gt;"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Add inking to your React Native for Windows application · React Native for Windows + macOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://microsoft.github.io/react-native-windows/blog/2021/05/25/inking"/><meta property="og:description" content="&lt;head&gt;"/><meta property="og:image" content="https://microsoft.github.io/react-native-windows/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://microsoft.github.io/react-native-windows/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/react-native-windows/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"/><link rel="stylesheet" href="/react-native-windows/css/code-block-buttons.css"/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/react-native-windows/js/code-block-buttons.js"></script><script type="text/javascript" src="/react-native-windows/js/nav-buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/react-native-windows/js/scrollSpy.js"></script><link rel="stylesheet" href="/react-native-windows/css/prism.css"/><link rel="stylesheet" href="/react-native-windows/css/main.css"/><script src="/react-native-windows/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/react-native-windows/"><img class="logo" src="/react-native-windows/img/header_logo.svg" alt="React Native for Windows + macOS"/><h2 class="headerTitleWithLogo">React Native for Windows + macOS</h2></a><a href="/react-native-windows/versions"><h3>0.79</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/react-native-windows/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/react-native-windows/docs/flyout-component" target="_self">APIs</a></li><li class=""><a href="https://devblogs.microsoft.com/react-native/" target="_self">Blog</a></li><li class=""><a href="/react-native-windows/resources" target="_self">Resources</a></li><li class=""><a href="https://github.com/microsoft/react-native-windows-samples/tree/main/samples" target="_self">Samples</a></li><li class=""><a href="/react-native-windows/support" target="_self">Support</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2022/07/29/coreapp">Streamlining app creation with React Native for Windows CoreApp</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2022/02/11/settings">React Native for Windows is helping Settings improve more quickly</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2022/02/11/rnwinrt">Calling Windows APIs from React Native just got easier</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2021/08/05/win32component">Use Win32 features from a React Native for Windows application</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/blog/2021/06/30/notifications">Add Toast notifications to your React Native for Windows application</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/react-native-windows/blog/2021/05/25/inking">Add inking to your React Native for Windows application</a></h1><p class="post-meta">May 25, 2021</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/qmatteoq" target="_blank" rel="noreferrer noopener">Matteo Pagani</a></p></div></header><div><span><p><head>
<meta http-equiv="Refresh" content="0; URL=https://devblogs.microsoft.com/react-native/rnw-inking/" />
</head></p>
<p>Windows 10 is one of the most powerful platforms on the market when it comes to supporting digital inking experiences. As such, the Universal Windows Platform comes with a dedicated series of controls that you can add to your application to enable inking experiences. Thanks to these controls, you can easily implements features like capturing signatures, text and shape recognition, etc.</p>
<p>If you're building a Windows application with React Native, there are a few options you can explore to add such a feature. One of them is using a community module called <a href="https://github.com/creambyemute/react-native-sketch-canvas">react-native-sketch-canvas</a>, which provides a Windows implementation as well. This module is based on Win2D and it enables the recording and playback of ink strokes. While this solution can be a great fit for many applications, there are scenarios in which you need more precision and better integration with the Windows ecosystem, like when you need to capture a signature. For these purposes, Windows 10 offers a native control called <a href="https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.InkCanvas"><code>InkCanvas</code></a>, which enables powerful inking experiences. <code>InkCanvas</code> is specifically a Windows control and isn't exposed automatically by React Native. As such, we'll have to wrap it with a <a href="https://microsoft.github.io/react-native-windows/docs/view-managers">native UI component</a>, which is a feature provided by React Native which exposes native UI controls for Windows, Android or iOS to the JavaScript layer using JSX.</p>
<p>In this article we'll walk through the process of wrapping the <code>InkCanvas</code> control, with the dual goals of enabling your apps to support inking and walking you through the process of creating a native UI component, which can be useful for exposing other native controls.</p>
<!--truncate-->
<h3><a class="anchor" aria-hidden="true" id="create-a-native-module"></a><a href="#create-a-native-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create a native module</h3>
<p>From a development perspective, there are no differences between <a href="https://microsoft.github.io/react-native-windows/docs/native-modules">a native module</a> and a native UI component. They are both defined inside a Windows Runtime Component, which exposes a <code>ReactPackageProvider</code> class that gets registered by the main application via autolinking.
You can either choose to build <a href="https://microsoft.github.io/react-native-windows/docs/native-modules-setup#creating-a-new-native-module-library-project">a dedicated native module library</a> or you can just <a href="https://microsoft.github.io/react-native-windows/docs/native-modules-setup#referencing-windows-apis-within-a-react-native-for-windows-project">add your Windows Runtime Component to your React Native for Windows solution</a>. The first approach is suggested if you're planning to share your module and reuse it with multiple projects; the second one is good if it's a one-time module you're planning to use only with the app you're building.</p>
<p>The documentation on the official website is very clear and detailed, so I won't repeat the steps in this article. I'm going to use a C# Windows Runtime Component, since it's the language I'm more familiar with, but you can do the same with C++.</p>
<h3><a class="anchor" aria-hidden="true" id="create-a-custom-control"></a><a href="#create-a-custom-control" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create a custom control</h3>
<p>The first step is to create a user control which we want to make available to the JavaScript layer via JSX. You can choose to create the control in code or via XAML. In this article, I will guide you through the XAML approach, so right click on the Windows Runtime Component, choose <strong>Add -&gt; New item</strong>, select the <strong>User Control</strong> template and give it a meaningful name, like <code>InkCanvasControl.xaml</code>.</p>
<p>You can start working on the look &amp; feel of the User Control in the XAML file, based on your requirements. We could just add an <code>InkCanvas</code> control for our purpose but, for the sake of showing a more realistic scenario, let's make the UI slightly more complex:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserControl</span>
    <span class="hljs-attr">x:Class</span>=<span class="hljs-string">"InkCanvasModule.InkCanvasControl"</span>
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="hljs-attr">xmlns:local</span>=<span class="hljs-string">"using:InkCanvasModule"</span>
    <span class="hljs-attr">xmlns:d</span>=<span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="hljs-attr">xmlns:mc</span>=<span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="hljs-attr">mc:Ignorable</span>=<span class="hljs-string">"d"</span>
    <span class="hljs-attr">d:DesignHeight</span>=<span class="hljs-string">"300"</span>
    <span class="hljs-attr">d:DesignWidth</span>=<span class="hljs-string">"400"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"50"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RowDefinition</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"*"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Grid.RowDefinitions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"{x:Bind Path=Title}"</span> <span class="hljs-attr">Style</span>=<span class="hljs-string">"{StaticResource HeaderTextBlockStyle}"</span> 
                   <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">HorizontalAlignment</span>=<span class="hljs-string">"Center"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">InkCanvas</span> <span class="hljs-attr">x:Name</span>=<span class="hljs-string">"MyInkCanvas"</span> <span class="hljs-attr">Width</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attr">Grid.Row</span>=<span class="hljs-string">"1"</span>  /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserControl</span>&gt;</span>
</code></pre>
<p>The <code>InkCanvas</code> control is placed inside a <code>Grid</code> together with a <code>TextBlock</code> control, which is used to display a header. Exactly like we would do with a standard User Control, the title isn't fixed, but it's connected to a dependency property via binding. This enables us, as developers, to customize the title when we add the User Control to a page. In the React Native context, this is is the first step to expose the property to JSX, so that we can customize the look &amp; feel of the control directly in JavaScript.</p>
<p>In the code behind of the control we have, of course, to define <code>Title</code> as a dependency property:</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Title
<span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span><span class="token function">GetValue</span><span class="token punctuation">(</span>TitlePropertyField<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span> <span class="token function">SetValue</span><span class="token punctuation">(</span>TitlePropertyField<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Using a DependencyProperty as the backing store for Title.  This enables animation, styling, binding, etc...</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">DependencyProperty</span> TitlePropertyField <span class="token operator">=</span>
    DependencyProperty<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">"Title"</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">InkCanvasControl</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyMetadata</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token return-type class-name">DependencyProperty</span> TitleProperty
<span class="token punctuation">{</span>
    <span class="token keyword">get</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TitlePropertyField<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The last change to do in the code behind is adding the following line in the public constructor:</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">public</span> <span class="token function">InkCanvasControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MyInkCanvas<span class="token punctuation">.</span>InkPresenter<span class="token punctuation">.</span>InputDeviceTypes <span class="token operator">=</span> Windows<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>CoreInputDeviceTypes<span class="token punctuation">.</span>Mouse <span class="token operator">|</span> Windows<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>CoreInputDeviceTypes<span class="token punctuation">.</span>Touch <span class="token operator">|</span> Windows<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>CoreInputDeviceTypes<span class="token punctuation">.</span>Pen<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This will enable the canvas to receive ink inputs from multiple devices, including mouse, which is especially useful during testing if you don't have a pen-enabled device.</p>
<h3><a class="anchor" aria-hidden="true" id="expose-the-user-control-to-react-native"></a><a href="#expose-the-user-control-to-react-native" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Expose the user control to React Native</h3>
<p>So far, we didn't do anything related to React Native. We built a User Control in the same way we would do for a traditional UWP application. To expose it to React Native and use the control in JSX we need to add a new class to our Windows Runtime Component which will wrap the User Control in a View Manager.
Right click on the Windows Runtime Component, choose <strong>Add -&gt; Class</strong> and give it a meaningful name (a common convention is the name of the control followed by the <code>ViewManager</code> suffix, like <code>InkCanvasControlViewManager.cs</code>).
The class must be marked as <code>internal</code> and inherit from <code>AttributedViewManager&lt;T&gt;</code>, where <code>T</code> is the user control. For example, this is how it looks like for the <code>InkCanvasControl</code> we have previously created:</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>Managed</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">InkCanvasModule</span>
<span class="token punctuation">{</span>
    <span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">InkCanvasControlViewManager</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AttributedViewManager<span class="token punctuation">&lt;</span>InkCanvasControl<span class="token punctuation">></span></span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">//add code here </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now we are ready to expose native features of the user control to the JavaScript layer. The React Native for Windows SDK enables us to expose multiple elements:</p>
<ul>
<li><strong>Properties</strong>, which can be used to customize the user control.</li>
<li><strong>Commands</strong>, which can be used to interact with the user control.</li>
<li><strong>Events</strong>, which can be used to react to changes in the user control.</li>
</ul>
<p>In the following sections we're going to see how to implement all three scenarios. But before doing that, let's see how we can expose the native control to JavaScript.
The process is the same you would follow <a href="https://microsoft.github.io/react-native-windows/docs/native-modules-setup">for a native module</a>. First, you have to add a new class to your Windows Runtime Component called <code>ReactPackageProvider</code>, which must have the following implementation:</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>ReactNative</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">InkCanvasModule</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">ReactPackageProvider</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReactPackageProvider</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreatePackage</span><span class="token punctuation">(</span><span class="token class-name">IReactPackageBuilder</span> packageBuilder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">CreatePackageImplementation</span><span class="token punctuation">(</span>packageBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary></span>
        <span class="token comment">/// This method is implemented by the C# code generator</span>
        <span class="token comment">/// &lt;/summary></span>
        <span class="token keyword">partial</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreatePackageImplementation</span><span class="token punctuation">(</span><span class="token class-name">IReactPackageBuilder</span> packageBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then you have to register the module with your main React Native application. If you're building this component as a dedicated native module, you can leverage <a href="https://microsoft.github.io/react-native-windows/docs/native-modules-autolinking">autolinking</a> to do everything automatically. If, instead, you have added the component as a project to an existing React Native for Windows solution, you can follow <a href="https://microsoft.github.io/react-native-windows/docs/native-modules-using">the manual linking</a> approach.</p>
<p>Once the native module is linked, you can reference it in JavaScript using the <code>requireNativeComponent()</code> function:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>requireNativeComponent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span>

<span class="token keyword">const</span> InkCanvas <span class="token operator">=</span> <span class="token function">requireNativeComponent</span><span class="token punctuation">(</span><span class="token string">'InkCanvasControl'</span><span class="token punctuation">)</span>
</code></pre>
<p>As parameter, you have to pass the name of the class which defines the User Control you have previously created (<code>InkCanvasControl</code>, in our example).
From now on, you will be able to reference the control in JSX using the <code>InkCanvas</code> constant, like in the following example:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span>InkCanvas style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="enabling-the-inkcanvas-control-in-a-react-native-for-windows-app"></a><a href="#enabling-the-inkcanvas-control-in-a-react-native-for-windows-app" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enabling the InkCanvas control in a React Native for Windows app</h3>
<p>If you test the implementation so far, you will notice that the header will be rendered fine, but the <code>InkCanvas</code> won't work. The reason can be found <a href="https://microsoft.github.io/react-native-windows/docs/view-managers#note-about-uwp-xaml-controls">in the documentation</a>:</p>
<blockquote>
<p>Some UWP XAML controls do not support being hosted in environments where 3D transforms are involved (i.e. the Transform3D property is set on the control or on any of the control's ancestors in the XAML tree).
Currently, React Native for Windows uses a global PerspectiveTransform to provide a 3D look to objects being rotated along the x or y axes, which means these controls that do not work in 3D environments, will not work out of the box.</p>
</blockquote>
<p><code>InkCanvas</code> is exactly one of these controls that doesn't work in a 3D environment. React Native for Windows offers us a workaround which, however, is supported only starting from version 0.64.
As the documentation explains, React Native for Windows supports an experimental feature to disable the 3D perspective. Open the <code>MainPage.xaml</code> file in your React Native project, in which you'll find the <code>ReactRootView</code> control which hosts the React Native content. Add a new property to the control called <code>IsPerspectiveEnabled</code> and set it to <code>False</code>. This is how the control should look like:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">react:ReactRootView</span> 
    <span class="hljs-attr">x:Name</span>=<span class="hljs-string">"reactRootView"</span>
    <span class="hljs-attr">ComponentName</span>=<span class="hljs-string">"InkCanvasv064"</span>
    <span class="hljs-attr">IsPerspectiveEnabled</span>=<span class="hljs-string">"False"</span>
    <span class="hljs-attr">Background</span>=<span class="hljs-string">"{ThemeResource ApplicationPageBackgroundThemeBrush}"</span>
    <span class="hljs-attr">MinHeight</span>=<span class="hljs-string">"400"</span>/&gt;</span>
</code></pre>
<p>That's it. Now we can continue the implementation of the features of our custom control.</p>
<h3><a class="anchor" aria-hidden="true" id="exposing-a-property"></a><a href="#exposing-a-property" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exposing a property</h3>
<p>This isn't stricly related to enable inking, but it's a good learning when it comes to build native UI modules. The goal of this section is to expose the dependency property called <code>Title</code> that we have created to JavaScript, so that we can customize it using JSX. Properties can be exposed using the <code>ViewManagerProperty</code> attribute, like in the following sample:</p>
<pre><code class="hljs css language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ViewManagerProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetTitle</span><span class="token punctuation">(</span><span class="token class-name">InkCanvasControl</span> view<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        view<span class="token punctuation">.</span>Title <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        view<span class="token punctuation">.</span><span class="token function">ClearValue</span><span class="token punctuation">(</span>InkCanvasControl<span class="token punctuation">.</span>TitleProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The method, called <code>SetTitle()</code>, is decorated with the <code>ViewManagerProperty</code> attribute, which sets the name that will be used to expose the property to JSX (in this case, it's <code>title</code> in lowercase, to follow the JavaScript naming conventions).
The method receives, as input, a reference to the user control and the value assigned via JSX. The implementation of the method is straigthforward: if the property assigned in JSX has a value, we assign it to the <code>Title</code> property of the user control; otherwise, we clear it.</p>
<p>Now we'll be able to leverage the <code>title</code> property in our React Native components, like in the following sample:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span>InkCanvas style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                   title<span class="token operator">=</span><span class="token string">"Hello world!"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>And this is the final result:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-25-inking/HelloWorld.png" alt=""></p>
<h3><a class="anchor" aria-hidden="true" id="exposing-a-command"></a><a href="#exposing-a-command" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exposing a command</h3>
<p>One of the most common features that developers want to implement when they work with inking is the ability to save the content of the <code>InkCanvas</code> control as an image. To enable this feature we're going to implement a command. The concept is very similar to exposing a method in a React Native module and it will enable us to trigger, from JavaScript, the native APIs exposed by the <code>InkCanvas</code> control to render the ink into a stream.</p>
<p>The first step is to install a library called <a href="https://github.com/microsoft/Win2D">Win2D</a>, which enables advanced 2D operations in a UWP app. Thanks to this library, we'll be able to render the content of the canvas into a stream that we can save into a file. To install it, right click on your Windows Runtime Component, choose <strong>Manage NuGet Packages</strong> and look for the <a href="https://www.nuget.org/packages/Win2D.uwp/">Win2D package</a>.</p>
<p>The command is defined using the <code>ViewManagerCommand</code> attribute which, like in the previous section, accepts a parameter that specifies the name of the method that will be exposed to JavaScript. This is the full implementation:</p>
<pre><code class="hljs css language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ViewManagerCommand</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"saveInkToFile"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">SaveInkToFile</span><span class="token punctuation">(</span><span class="token class-name">InkCanvasControl</span> view<span class="token punctuation">,</span> <span class="token class-name">IReadOnlyList<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> commandArgs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> commandArgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> inkCanvas <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">FindName</span><span class="token punctuation">(</span><span class="token string">"MyInkCanvas"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">InkCanvas</span><span class="token punctuation">;</span>

    <span class="token class-name">CanvasDevice</span> device <span class="token operator">=</span> CanvasDevice<span class="token punctuation">.</span><span class="token function">GetSharedDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CanvasRenderTarget</span> renderTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CanvasRenderTarget</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>inkCanvas<span class="token punctuation">.</span>ActualWidth<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>inkCanvas<span class="token punctuation">.</span>ActualHeight<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> ds <span class="token operator">=</span> renderTarget<span class="token punctuation">.</span><span class="token function">CreateDrawingSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ds<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span>Colors<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">DrawInk</span><span class="token punctuation">(</span>inkCanvas<span class="token punctuation">.</span>InkPresenter<span class="token punctuation">.</span>StrokeContainer<span class="token punctuation">.</span><span class="token function">GetStrokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">FileSavePicker</span> fileSavePicker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileSavePicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileSavePicker<span class="token punctuation">.</span>FileTypeChoices<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">".jpg"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileSavePicker<span class="token punctuation">.</span>SuggestedFileName <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> file <span class="token operator">=</span> <span class="token keyword">await</span> fileSavePicker<span class="token punctuation">.</span><span class="token function">PickSaveFileAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> fileStream <span class="token operator">=</span> <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">OpenAsync</span><span class="token punctuation">(</span>FileAccessMode<span class="token punctuation">.</span>ReadWrite<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> renderTarget<span class="token punctuation">.</span><span class="token function">SaveAsync</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">,</span> CanvasBitmapFileFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">,</span> <span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The method receives, as input, a reference to the user control and a series of parameters that the JavaScript app can pass to it. In our scenario, we're getting from the JavaScript layer the default name of the file that is suggested when you save the image.
The method performs the following actions:</p>
<ol>
<li>It retrieves a reference to the <code>InkCanvas</code> control included in the User Control, using the <code>FindName()</code> method.</li>
<li>It creates a <code>CanvasRenderTarget</code> to store the inking session, which is exposed by the <code>InkPresenter</code> property of the <code>InkCanvas</code> control.</li>
<li>It uses the <code>FileSavePicker</code> API to prompt to the user where he/she/they want to save the image. Once we have a reference to the destination file, we use the <code>SaveAsync()</code> method of the <code>CanvasRenderTarget</code> object to save the stream.</li>
</ol>
<p>In this scenario, we can use a simple command because we are interacting with the User Control, but we aren't expecting anything in return. The content of the <code>InkCanvas</code> will be just saved to a file and then the operation will be considered completed.</p>
<p>Now we can leverage the command directly in JavaScript, as in the following example:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  <span class="token function-variable function">saveInk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_inkCanvasRef<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token function">findNodeHandle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_inkCanvasRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
      UIManager<span class="token punctuation">.</span><span class="token function">dispatchViewManagerCommand</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> UIManager<span class="token punctuation">.</span><span class="token function">getViewManagerConfig</span><span class="token punctuation">(</span><span class="token string">'InkCanvasControl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Commands<span class="token punctuation">.</span>saveInkToFile<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ink.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span>Button title<span class="token operator">=</span><span class="token string">"Save ink"</span> onPress<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveInk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>

        <span class="token operator">&lt;</span>InkCanvas ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_inkCanvasRef <span class="token operator">=</span> ref<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                   style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                   title<span class="token operator">=</span><span class="token string">"Hello world!"</span> 
                   <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>As first step, we have to use the <code>ref</code> property to store a reference to the <code>InkCanvas</code> control in JSX. Then, we can use this reference to create a function that will invoke our command by using the <code>UIManager.dispatchViewManagerCommand()</code> function. It requires as input:</p>
<ol>
<li>The tag associated to the <code>InkCanvasControl</code>, which we get by calling the <code>findNodeHandle()</code> method with the reference we have previously stored.</li>
<li>The command to execute, which is exposed by the <code>UIManager.getViewManagerConfig().Commands</code> function. There are two key concept here to highlight: the parameter we pass to the <code>getViewManagerConfig()</code> method is the name of the class which hosts our User Control (<code>InkCanvasControl</code>); the <code>Commands</code> property, instead, exposes all our commands using the name we have passed to the <code>ViewManagerCommand</code> attribute (in this case, we're using the <code>saveInkToFile</code> one).</li>
<li>This is optional. If your command accepts one or more arguments coming from the JavaScript layer. you can pass them here as an array. In our scenario, we are passing the default name of the image that will be used by the <code>FileSavePicker</code> APIs.</li>
</ol>
<p>Now that we have defined a JavaScript function, we can just connect it to the <code>onPress</code> event of a <code>Button</code> control. When you press the button, this is what you're going to see:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-25-inking/FileSavePicker.png" alt=""></p>
<p>The picker will show up and will ask you where you want to save the image. Once the operation is completed, you will find in that location an image with the content of the <code>InkCanvas</code> control.</p>
<h3><a class="anchor" aria-hidden="true" id="exposing-an-event-handler"></a><a href="#exposing-an-event-handler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exposing an event handler</h3>
<p>Another common inking scenario is the requirement to save the content of the canvas, but not as a file on the device, but as as base64 encoded string. This enables developers to send the image, for example, to a cloud service for further processing.
The APIs we need to use in the native layer are almost the same as the previous scenario. However, in this case, there's an important difference: it isn't anymore a fire &amp; forget command, but we need to get a result back.</p>
<p>Commands don't directly support the option to return a value. However, for these scenarios we can use <strong>events</strong>. We'll trigger a command to save the content of the canvas as a base64 image and then we'll raise an event, passing the image as parameter. In JavaScript, we'll subscribe to this event so that we can receive the base64 image when it's ready.</p>
<p>Events are implemented using the <code>ViewManagerEvent</code> class and they are decorated with the <code>ViewManagerExportedDirectEventTypeConstant</code> attribute:</p>
<pre><code class="hljs css language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ViewManagerExportedDirectEventTypeConstant</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token class-name">ViewManagerEvent<span class="token punctuation">&lt;</span>InkCanvasControl<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> InkSaved <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre>
<p>The event is defined as a <code>ViewManagerEvent&lt;T, Y&gt;</code>, where <code>T</code> is the name of the class which will raise the event (our user control), while <code>Y</code> is the type of the data that will be returned (the <code>string</code> which contains the image encoded in base64).</p>
<p>Now we can define our command using, again, the <code>ViewManagerCommand</code> attribute:</p>
<pre><code class="hljs css language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ViewManagerCommand</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"saveInkToBase64"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">SaveInkToBase64</span><span class="token punctuation">(</span><span class="token class-name">InkCanvasControl</span> view<span class="token punctuation">,</span> <span class="token class-name">IReadOnlyList<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">></span></span> commandArgs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> inkCanvas <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">FindName</span><span class="token punctuation">(</span><span class="token string">"MyInkCanvas"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">InkCanvas</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">string</span></span> base64String <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>

    <span class="token class-name">CanvasDevice</span> device <span class="token operator">=</span> CanvasDevice<span class="token punctuation">.</span><span class="token function">GetSharedDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CanvasRenderTarget</span> renderTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CanvasRenderTarget</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>inkCanvas<span class="token punctuation">.</span>ActualWidth<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>inkCanvas<span class="token punctuation">.</span>ActualHeight<span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> ds <span class="token operator">=</span> renderTarget<span class="token punctuation">.</span><span class="token function">CreateDrawingSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ds<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span>Colors<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">DrawInk</span><span class="token punctuation">(</span>inkCanvas<span class="token punctuation">.</span>InkPresenter<span class="token punctuation">.</span>StrokeContainer<span class="token punctuation">.</span><span class="token function">GetStrokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">InMemoryRandomAccessStream</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InMemoryRandomAccessStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> renderTarget<span class="token punctuation">.</span><span class="token function">SaveAsync</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> CanvasBitmapFileFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">GetInputStreamAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> reader<span class="token punctuation">.</span><span class="token function">LoadAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>stream<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> byteArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>stream<span class="token punctuation">.</span>Size<span class="token punctuation">]</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">ReadBytes</span><span class="token punctuation">(</span>byteArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        base64String <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>byteArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    InkSaved<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> base64String<span class="token punctuation">)</span><span class="token punctuation">;</span>         
<span class="token punctuation">}</span>
</code></pre>
<p>The core of the implementation is the same as the previous one. The main difference is that, instead of using the <code>FileSavePicker</code> APIs, we're storing the content of the canvas in an <code>InMemoryRandomAccessStream</code> object. Then, using the <code>DataReader</code> class, we read the stream and we convert it into a base64 string.
In the end, we raise the event we have previously created with the <code>Invoke()</code> method, passing as parameter the reference to the <code>InkCanvasControl</code> that we have and the base64 string we have just created.</p>
<p>Let's see now how we can use the event in JavaScript:</p>
<pre><code class="hljs css language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  <span class="token function-variable function">saveInkToBase64</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_inkCanvasRef<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token function">findNodeHandle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_inkCanvasRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
      UIManager<span class="token punctuation">.</span><span class="token function">dispatchViewManagerCommand</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> UIManager<span class="token punctuation">.</span><span class="token function">getViewManagerConfig</span><span class="token punctuation">(</span><span class="token string">'InkCanvasControl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Commands<span class="token punctuation">.</span>saveInkToBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">onGetInk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token string">'data:image/png;base64,'</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View<span class="token operator">></span>
        <span class="token operator">&lt;</span>Button title<span class="token operator">=</span><span class="token string">"Save ink to base64"</span> onPress<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveInkToBase64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>InkCanvas ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_inkCanvasRef <span class="token operator">=</span> ref<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                   style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                   title<span class="token operator">=</span><span class="token string">"Hello world!"</span>
                   onInkSaved<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onGetInk</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>The implementation of the command is the same we have seen in the previous section. The difference is that, this time, the <code>InkCanvas</code> control in JSX exposes also an <code>onInkSaved</code> event, that we can subscribe.
The subscription is handled by the <code>onGetInk()</code> function which receives, as parameter, the image in base64 returned by the native module. When the user presses the button, React Native will trigger the <code>saveInkToBase64</code> command exposed by the control. Once the generation of the image encoded in a base64 string is completed in the native layer, the <code>onInkSaved</code> event will be raised and the <code>onGetInk()</code> function will be executed.</p>
<p>In this example we're just showing the base64 string in the debugger console, but we could also set it as source of an <code>Image</code> control to display it, like in the example below:</p>
<p><img src="/react-native-windows/blog/assets/2021-05-25-inking/base64string.png" alt=""></p>
<h3><a class="anchor" aria-hidden="true" id="wrapping-up"></a><a href="#wrapping-up" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Wrapping up</h3>
<p>In this article we have learned how to enable inking features in our React Native for Windows application, by wrapping the <code>InkCanvas</code> control in a native UI module. However, the lessons we have learned aren't specific to the inking scenario, but they can be applied anytime you have a native Windows control that it isn't directly supported by React Native but that you would like to use in your applications.</p>
<p>I would like to thank <a href="https://twitter.com/alexsklar">Alexander Sklar</a> for the guidance he provided during the implementation of this feature.</p>
<p>You can find the sample project used in this article <a href="https://github.com/qmatteoq/rnw-inkcanvas">on GitHub</a>.</p>
</span></div></div><div class="blogSocialSection"></div></div><div class="blog-recent"><a class="button" href="/react-native-windows/blog/">Recent Posts</a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>React Native Docs</h5><a href="https://reactnative.dev/docs/getting-started">Getting Started</a><a href="https://reactnative.dev/docs/tutorial">Tutorial</a><a href="https://reactnative.dev/docs/components-and-apis">Components and APIs</a><a href="https://reactnative.dev/docs/more-resources">More Resources</a></div><div><h5>React Native for Windows + macOS Docs</h5><div style="color:white;font-weight:500;font-size:16px"><a href="/react-native-windows/docs/getting-started">Get Started with Windows</a></div><div style="color:white;font-weight:500;font-size:16px"><a href="/react-native-windows/docs/rnm-getting-started"> Get Started with macOS</a></div><a href="/react-native-windows/docs/parity-status">React Native Windows Components and APIs</a><a href="/react-native-windows/docs/native-modules">Native Modules</a><a href="/react-native-windows/docs/view-managers">Native UI Components</a></div><div><h5>Connect With Us On</h5><a href="https://devblogs.microsoft.com/react-native/">Blog</a><a href="https://twitter.com/ReactNativeMSFT" target="_blank">Twitter</a><a href="https://github.com/microsoft/react-native-windows" target="_blank">GitHub</a><a href="https://github.com/microsoft/react-native-windows-samples/tree/main/samples" target="_blank">Samples</a></div></section></footer></div></body></html>