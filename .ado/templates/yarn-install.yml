parameters:
- name: workingDirectory
  type: string
  default: .
- name: agentEnvironment
  type: string
  default: ManagedImage
  values:
      - ManagedImage
      - HostedImage

steps:
  # When using our own images, prefer the machine-installed version of
  # `midgard-yarn`.
  - ${{ if eq(parameters.agentEnvironment, 'ManagedImage') }}:
    - script: midgard-yarn --frozen-lockfile --cwd ${{ parameters.workingDirectory }}
      displayName: midgard-yarn (faster yarn install)

  # If using an image we don't control, acquire a fixed version of midgard-yarn
  # before install
  - ${{ else }}:
    - script: npx --yes midgard-yarn@1.23.34 --frozen-lockfile --cwd ${{ parameters.workingDirectory }}
      displayName: midgard-yarn (faster yarn install)
