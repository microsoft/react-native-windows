parameters:
  - name: solution
    type: string

steps:
  - task: Cache@2
    inputs:
      key: '"restore-sln" | "${{ parameters.solution }}" | ${{ parameters.solution }}/../NuGet.config | **/packages.config | **/packages.lock.json'
      restoreKeys: '"restore-sln" | "${{ parameters.solution }}" | ${{ parameters.solution }}/../NuGet.config'
      path: ${{ parameters.solution }}/../packages/
    displayName: Copy cached NuGet packages

  # NuGetCommand@2 workaround: https://developercommunity.visualstudio.com/content/problem/288534/vsts-yaml-build-failure-the-task-name-nugetcommand.html
  - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
    displayName: NuGet restore
    inputs:
      command: restore
      restoreSolution: ${{ parameters.solution }}
      feedsToUse: config
      nugetConfigPath: ${{ parameters.solution }}/../NuGet.config
      restoreDirectory: packages/
      verbosityRestore: Detailed
