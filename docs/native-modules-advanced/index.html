<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Native Modules and React Native Windows (Advanced Topics) · React Native for Windows</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; **This documentation and the underlying platform code is a work in progress.** &gt;**Examples (C# and C++/WinRT):**"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Native Modules and React Native Windows (Advanced Topics) · React Native for Windows"/><meta property="og:type" content="website"/><meta property="og:url" content="https://microsoft.github.io/react-native-windows/"/><meta property="og:description" content="&gt; **This documentation and the underlying platform code is a work in progress.** &gt;**Examples (C# and C++/WinRT):**"/><meta property="og:image" content="https://microsoft.github.io/react-native-windows/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://microsoft.github.io/react-native-windows/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/react-native-windows/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://microsoft.github.io/react-native-windows/blog/atom.xml" title="React Native for Windows Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://microsoft.github.io/react-native-windows/blog/feed.xml" title="React Native for Windows Blog RSS Feed"/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/react-native-windows/js/scrollSpy.js"></script><link rel="stylesheet" href="/react-native-windows/css/prism.css"/><link rel="stylesheet" href="/react-native-windows/css/main.css"/><script src="/react-native-windows/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/react-native-windows/"><img class="logo" src="/react-native-windows/img/header_logo.svg" alt="React Native for Windows"/><h2 class="headerTitleWithLogo">React Native for Windows</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/react-native-windows/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/react-native-windows/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/microsoft/react-native-windows-samples/tree/master/samples" target="_self">Samples</a></li><li class=""><a href="https://github.com/microsoft/react-native-windows" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Native Modules</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">The Basics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-windows/docs/getting-started">Getting Started (vnext)</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/docs/contributing">Contributing to microsoft/react-native-windows</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/docs/parity-status">Component and Module API Parity Status</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Testing<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-windows/docs/e2e-test">Author and Run E2E Test for React Native Windows</a></li><li class="navListItem"><a class="navItem" href="/react-native-windows/docs/e2e-test-more-about">More about E2E test</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Native Modules<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-windows/docs/native-modules">Native Modules and React-Native-Windows</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/react-native-windows/docs/native-modules-advanced">Native Modules and React Native Windows (Advanced Topics)</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/microsoft/react-native-windows-samples/blob/master/docs/native-modules-advanced.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Native Modules and React Native Windows (Advanced Topics)</h1></header><article><div><span><blockquote>
<p><strong>This documentation and the underlying platform code is a work in progress.</strong> &gt;<strong>Examples (C# and C++/WinRT):</strong></p>
<ul>
<li><a href="https://github.com/microsoft/react-native-windows-samples/tree/master/samples/NativeModuleSample">Native Module Sample in microsoft/react-native-windows-samples</a></li>
<li><a href="../../packages/microsoft-reactnative-sampleapps">Sample App in microsoft/react-native-windows/packages/microsoft-reactnative-sampleapps</a></li>
</ul>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="writing-native-modules-without-using-attributes-c"></a><a href="#writing-native-modules-without-using-attributes-c" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing Native Modules without using Attributes (C#)</h2>
<p>The <a href="/react-native-windows/docs/native-modules">Native Modules</a> page describes how you can author Native Modules in both C# and C++ using an attribute-based approach. The attribute-based approach makes it easy for you to author your native modules because it uses reflection to help React Native understand your native module.</p>
<p>In rare cases, you may need to write a native module against the ABI directly without using reflection. The high-level steps remain the same:</p>
<ol>
<li>Author your native module</li>
<li>Register your native module</li>
<li>Use your native module</li>
</ol>
<p>However, your app will be responsible for handling the code that the attributes would have otherwise provided. This guide will walk through those steps.</p>
<h3><a class="anchor" aria-hidden="true" id="1-authoring-your-native-module"></a><a href="#1-authoring-your-native-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Authoring your Native Module</h3>
<p>Here is the same <code>FancyMath</code> native module, but we do not use custom attributes and we're instead going to implement registration of its members ourselves without using reflection.</p>
<p><em>FancyMath.cs</em></p>
<pre><code class="hljs css language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>Managed<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> NativeModuleSample
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">FancyMath</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> E <span class="token operator">=</span> Math<span class="token punctuation">.</span>E<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> PI <span class="token operator">=</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="2-registering-your-native-module"></a><a href="#2-registering-your-native-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Registering your Native Module</h3>
<p>Here's our <code>FancyMathPackageProvider</code> where we manually register our native module's members.</p>
<p><em>FancyMathPackageProvider.cs</em></p>
<pre><code class="hljs css language-csharp"><span class="token keyword">namespace</span> NativeModuleSample
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">FancyMathPackageProvider</span> <span class="token punctuation">:</span> <span class="token class-name">IReactPackageProvider</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">CreatePackage</span><span class="token punctuation">(</span><span class="token class-name">IReactPackageBuilder</span> packageBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      packageBuilder<span class="token punctuation">.</span><span class="token function">AddModule</span><span class="token punctuation">(</span><span class="token string">"FancyMath"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">IReactModuleBuilder</span> moduleBuilder<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FancyMath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token string">"FancyMath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">AddConstantProvider</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">IJSValueWriter</span> writer<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          writer<span class="token punctuation">.</span><span class="token function">WritePropertyName</span><span class="token punctuation">(</span><span class="token string">"E"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          writer<span class="token punctuation">.</span><span class="token function">WriteDouble</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>E<span class="token punctuation">)</span><span class="token punctuation">;</span>
          writer<span class="token punctuation">.</span><span class="token function">WritePropertyName</span><span class="token punctuation">(</span><span class="token string">"Pi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          writer<span class="token punctuation">.</span><span class="token function">WriteDouble</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>PI<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">AddMethod</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> MethodReturnType<span class="token punctuation">.</span>Callback<span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token class-name">IJSValueReader</span> inputReader<span class="token punctuation">,</span>
          <span class="token class-name">IJSValueWriter</span> outputWriter<span class="token punctuation">,</span>
          <span class="token class-name">MethodResultCallback</span> resolve<span class="token punctuation">,</span>
          <span class="token class-name">MethodResultCallback</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
           inputReader<span class="token punctuation">.</span><span class="token function">ReadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           inputReader<span class="token punctuation">.</span><span class="token function">ReadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           inputReader<span class="token punctuation">.</span><span class="token function">TryGetDouble</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token keyword">double</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
           inputReader<span class="token punctuation">.</span><span class="token function">ReadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           inputReader<span class="token punctuation">.</span><span class="token function">TryGetDouble</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">double</span> result <span class="token operator">=</span> module<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
           writer<span class="token punctuation">.</span><span class="token function">WriteArrayBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           writer<span class="token punctuation">.</span><span class="token function">WriteDouble</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
           writer<span class="token punctuation">.</span><span class="token function">WriteArrayEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">resolve</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> module<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>As you can see, it is possible to use the API directly, but the code looks a little bit more complicated. You are responsible for creating your own constant provider, serializing each constant into the <code>IJSValueWriter</code>. For methods, you are also responsible for deserializing args, calling your code, and then serializing any return values. There are some (de)serialization helper methods to make that a little bit simpler:</p>
<p><em>FancyMathPackageProvider.cs</em></p>
<pre><code class="hljs css language-csharp"><span class="token keyword">namespace</span> NativeModuleSample
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">FancyMathPackageProvider</span> <span class="token punctuation">:</span> <span class="token class-name">IReactPackageProvider</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">CreatePackage</span><span class="token punctuation">(</span><span class="token class-name">IReactPackageBuilder</span> packageBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      packageBuilder<span class="token punctuation">.</span><span class="token function">AddModule</span><span class="token punctuation">(</span><span class="token string">"FancyMath"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">IReactModuleBuilder</span> moduleBuilder<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FancyMath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token string">"FancyMath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">AddConstantProvider</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">IJSValueWriter</span> writer<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          writer<span class="token punctuation">.</span><span class="token function">WriteProperty</span><span class="token punctuation">(</span><span class="token string">"E"</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>E<span class="token punctuation">)</span><span class="token punctuation">;</span>
          writer<span class="token punctuation">.</span><span class="token function">WriteProperty</span><span class="token punctuation">(</span><span class="token string">"Pi"</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>PI<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">AddMethod</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> MethodReturnType<span class="token punctuation">.</span>Callback<span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token class-name">IJSValueReader</span> inputReader<span class="token punctuation">,</span>
          <span class="token class-name">IJSValueWriter</span> outputWriter<span class="token punctuation">,</span>
          <span class="token class-name">MethodResultCallback</span> resolve<span class="token punctuation">,</span>
          <span class="token class-name">MethodResultCallback</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
           <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> inputReader<span class="token punctuation">.</span><span class="token function">ReadArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">double</span> result <span class="token operator">=</span> module<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           writer<span class="token punctuation">.</span><span class="token function">WriteArgs</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">resolve</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> module<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It is possible to simplify the code even more by hiding the use of the value reader and writer interfaces:</p>
<p><em>FancyMathPackageProvider.cs</em></p>
<pre><code class="hljs css language-csharp"><span class="token keyword">namespace</span> NativeModuleSample
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">FancyMathPackageProvider</span> <span class="token punctuation">:</span> <span class="token class-name">IReactPackageProvider</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">CreatePackage</span><span class="token punctuation">(</span><span class="token class-name">IReactPackageBuilder</span> packageBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      packageBuilder<span class="token punctuation">.</span><span class="token function">AddModule</span><span class="token punctuation">(</span><span class="token string">"FancyMath"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">IReactModuleBuilder</span> moduleBuilder<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FancyMath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token string">"FancyMath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">AddConstantProvider</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token operator">></span> <span class="token punctuation">{</span>
          <span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">]</span> <span class="token operator">=</span> module<span class="token punctuation">.</span>E<span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token string">"Pi"</span><span class="token punctuation">]</span> <span class="token operator">=</span> module<span class="token punctuation">.</span>PI
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        moduleBuilder<span class="token punctuation">.</span><span class="token function">AddMethod</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> MethodReturnType<span class="token punctuation">.</span>Callback<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">MethodCallContext</span> callContext<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">double</span> result <span class="token operator">=</span> module<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>callContext<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>callContext<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          callContext<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> module<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This code looks much better, but we are getting the overhead of boxing values that involves memory allocation for each call. The code generation that we do using LINQ Expression avoids this extra overhead. Though, the initial use of reflection and code generation has some penalty too.
From the maintenance point of view, the attributed code is much simple to support because we do not need to describe the same things in two different places.</p>
<p>And as for the rest of the code, once we have the <code>IReactPackageProvider</code>, registering that package is the same as in the example above that uses custom attributes.</p>
<h3><a class="anchor" aria-hidden="true" id="3-using-your-native-module-in-js"></a><a href="#3-using-your-native-module-in-js" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Using your Native Module in JS</h3>
<p>Using your native module in JS is the exact same as if the native module was defined using attributes.</p>
<p><em>NativeModuleSample.js</em></p>
<pre><code class="hljs css language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppRegistry<span class="token punctuation">,</span> Alert<span class="token punctuation">,</span> NativeModules<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-native"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NativeModuleSample</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">_onPressHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token comment">/* arg a */</span> NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span>Pi<span class="token punctuation">,</span>
      <span class="token comment">/* arg b */</span> NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span><span class="token constant">E</span><span class="token punctuation">,</span>
      <span class="token comment">/* callback */</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Alert<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>
          <span class="token string">"FancyMath"</span><span class="token punctuation">,</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">FancyMath says </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span>Pi<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span><span class="token constant">E</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token string">"OK"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> cancelable<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span><span class="token punctuation">></span></span>FancyMath says <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token punctuation">{</span>NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span>Pi<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span><span class="token punctuation">></span></span>FancyMath says <span class="token constant">E</span> <span class="token operator">=</span> <span class="token punctuation">{</span>NativeModules<span class="token punctuation">.</span>FancyMath<span class="token punctuation">.</span><span class="token constant">E</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_onPressHandler<span class="token punctuation">}</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Click me!<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

AppRegistry<span class="token punctuation">.</span><span class="token function">registerComponent</span><span class="token punctuation">(</span><span class="token string">"NativeModuleSample"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> NativeModuleSample<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="native-modules-with-custom-event-emitters"></a><a href="#native-modules-with-custom-event-emitters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Native Modules with Custom Event Emitters</h2>
<p>By default, native modules share a common <code>RCTDeviceEventEmitter</code> which emits the actual events into JavaScript. However, that comes with the limitation that all of the native modules must have globally unique event names. If you wanted to ensure that your event names didn't collide with other events from other native modules, you could create your own <code>EventEmitter</code>.</p>
<p>So say we have our FancyMath module, where we've specified <code>&quot;MathEmitter&quot;</code> as the name of the <code>EventEmitter</code>:</p>
<p><em>FancyMath.cs</em></p>
<pre><code class="hljs css language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>ReactNative<span class="token punctuation">.</span>Managed<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> NativeModuleSample
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token class-name">ReactModule</span><span class="token punctuation">(</span>EventEmitterName <span class="token operator">=</span> <span class="token string">"MathEmitter"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">class</span> <span class="token class-name">FancyMath</span>
  <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token class-name">ReactConstant</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> E <span class="token operator">=</span> Math<span class="token punctuation">.</span>E<span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token class-name">ReactConstant</span><span class="token punctuation">(</span><span class="token string">"Pi"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> PI <span class="token operator">=</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token class-name">ReactMethod</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">double</span> result <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        <span class="token function">AddEvent</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token class-name">ReactEvent</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> ReactEvent<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> AddEvent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now, when the native code calls <code>AddEvent</code>, that will be essentially translated into a JS call of <code>MathEmitter.emit(&quot;AddEvent&quot;, result)</code>.</p>
<p>So in order for this to work, you will need to create and register a <code>MathEmitter</code> module. You can create the module by and you can use the existing <code>EventEmitter</code> class.</p>
<p><em>MathEmitter.js</em></p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"EventEmitter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> BatchedBridge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"BatchedBridge"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

BatchedBridge<span class="token punctuation">.</span><span class="token function">registerLazyCallableModule</span><span class="token punctuation">(</span><span class="token string">"MathEmitter"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><em>TODO:</em> We should have a better E2E example here, however in practice naitve module developers don't bother to do this, so it's impossible to find any existing examples to reference.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/react-native-windows/docs/native-modules"><span class="arrow-prev">← </span><span>Native Modules and React-Native-Windows</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#writing-native-modules-without-using-attributes-c">Writing Native Modules without using Attributes (C#)</a><ul class="toc-headings"><li><a href="#1-authoring-your-native-module">1. Authoring your Native Module</a></li><li><a href="#2-registering-your-native-module">2. Registering your Native Module</a></li><li><a href="#3-using-your-native-module-in-js">3. Using your Native Module in JS</a></li></ul></li><li><a href="#native-modules-with-custom-event-emitters">Native Modules with Custom Event Emitters</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>React Native Docs</h5><a href="http://facebook.github.io/react-native/docs/getting-started.html">Getting Started</a><a href="http://facebook.github.io/react-native/docs/tutorial.html">Tutorial</a><a href="http://facebook.github.io/react-native/docs/components-and-apis.html">Components and APIs</a><a href="http://facebook.github.io/react-native/docs/more-resources.html">More Resources</a></div><div><h5>React Native for Windows Docs</h5><a href="/react-native-windows/docs/getting-started">Getting Started</a><a href="/react-native-windows/docs/parity-status">API parity with React Native</a><a href="/react-native-windows/docs/native-modules">Native Modules</a><a href="/react-native-windows/docs/view-managers">Native UI Components</a><a href="/react-native-windows/docs/windowsbrush-and-theme">Windows Brushes and Themes</a></div><div><h5>More Resources</h5><a href="/react-native-windows/blog/">Blog</a><a href="https://twitter.com/reactwindows" target="_blank">Twitter</a><a href="https://github.com/microsoft/react-native-windows" target="_blank">GitHub</a><a href="https://github.com/microsoft/react-native-windows-samples/tree/master/samples" target="_blank">Samples</a></div></section></footer></div></body></html>